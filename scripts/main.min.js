(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
'use strict';

var _app = require('app');

var _app2 = _interopRequireDefault(_app);

var _features = require('features');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*!
 *
 *  Web Starter Kit
 *  Copyright 2018 Google Inc. All rights reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *    https://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License
 *
 */
/* eslint-env browser */
// jshint esversion: 6

(function () {
  'use strict';

  // Check to make sure service workers are supported in the current browser,
  // and that the current page is accessed from a secure origin. Using a
  // service worker from an insecure origin will trigger JS console errors. See
  // http://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features

  var isLocalhost = Boolean(window.location.hostname === 'localhost' ||
  // [::1] is the IPv6 localhost address.
  window.location.hostname === '[::1]' ||
  // 127.0.0.1/8 is considered localhost for IPv4.
  window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));

  // Register the service worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      navigator.serviceWorker.register('sw.js').then(function (registration) {
        console.log('Service Worker registered!');
      }).catch(function (err) {
        console.log('Registration failed :(');
      });
    });
  }

  // Initialize app
  var app = new _app2.default();
  document.addEventListener('DOMContentLoaded', function () {
    if (!(0, _features.hasPrerequisites)()) {
      window.alert('This browser is missing some required features');
      return;
    }
    app.install();
    app.run();
  });
})();

},{"app":2,"features":6}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Copyright 2018 Google Inc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */

var _cart = require('cart');

var _cart2 = _interopRequireDefault(_cart);

var _idbStorage = require('idb-storage');

var _idbStorage2 = _interopRequireDefault(_idbStorage);

var _cartView = require('cart-view');

var _cartView2 = _interopRequireDefault(_cartView);

var _shopView = require('shop-view');

var _shopView2 = _interopRequireDefault(_shopView);

var _paymentForm = require('payment-form');

var _paymentForm2 = _interopRequireDefault(_paymentForm);

var _paymentApi = require('payment-api');

var _paymentApi2 = _interopRequireDefault(_paymentApi);

var _confirmationView = require('confirmation-view');

var _confirmationView2 = _interopRequireDefault(_confirmationView);

var _headerController = require('header-controller');

var _headerController2 = _interopRequireDefault(_headerController);

var _urlTools = require('url-tools');

var _features = require('features');

var features = _interopRequireWildcard(_features);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var App = function () {
  function App() {
    _classCallCheck(this, App);

    this._storage = features.hasIndexedDB ? new _idbStorage2.default() : new _idbStorage2.default();
    this._cart = new _cart2.default(this._storage, this._cartChanged.bind(this));
    this._cartView = new _cartView2.default(this._cart);
    this._shopView = new _shopView2.default(this._cart);
    this._paymentForm = new _paymentForm2.default(this._cart);
    this._confirmationView = new _confirmationView2.default();
    this._header = new _headerController2.default();
    this._hashChangeListener = this._handleHashChange.bind(this);
  }

  _createClass(App, [{
    key: 'install',
    value: function install() {
      window.addEventListener('hashchange', this._hashChangeListener);
      this._shopView.install();
      this._cartView.install();
    }
  }, {
    key: 'uninstall',
    value: function uninstall() {
      window.removeEventListener('hashchange', this._hashChangeListener);
    }

    // Manage element visibility (hide the cart when store is selected and vice versa)

  }, {
    key: 'run',
    value: function run() {
      var _this = this;

      (0, _urlTools.replaceLocationHash)('shop');
      this._cart.load().then(function () {
        _this._shopView.render();
        _this._cartView.render();
        _this._updateCartCountDisplay();
        _this.selection = 'shop';
      });
    }

    // Handle hashChange, manage history (#store or #cart, maybe #pay)

  }, {
    key: '_handleHashChange',
    value: function _handleHashChange(event) {
      if (!event.newURL) return;
      var index = event.newURL.lastIndexOf('#');
      if (index < 0) return;
      var sel = event.newURL.substr(index + 1);
      this.selection = sel;
    }
  }, {
    key: '_cartChanged',
    value: function _cartChanged(details) {
      if (details.action === 'load') return;
      this._updateCartCountDisplay();
      this._cartView.render();
      this._cart.save();
    }
  }, {
    key: '_updateCartCountDisplay',
    value: function _updateCartCountDisplay() {
      this._header.count = this._cart.count;
    }
    // Testing hooks

  }, {
    key: 'selection',
    set: function set(sel) {
      var _this2 = this;

      switch (sel) {
        case 'shop':
        case 'cart':
          this._header.selection = sel;
          this._shopView.visible = sel === 'shop';
          this._cartView.visible = sel !== 'shop';
          this._paymentForm.visible = false;
          this._confirmationView.visible = false;
          break;

        case 'pay':
          this._header.selection = 'cart';
          this._cartView.visible = true;
          this._confirmationView.visible = false;
          this._paymentForm.visible = false;
          var _promise = void 0;
          if (window.PaymentRequest) {
            var api = new _paymentApi2.default();
            _promise = api.checkout(this._cart);
          } else {
            this._paymentForm.visible = true;
            _promise = this._paymentForm.checkout(this._cart);
          }
          _promise.then(function () {
            _this2._cart.reset();
            (0, _urlTools.replaceLocationHash)('shop');
            _this2.selection = 'shop';
            alert('Thanks for shopping! Payment successfully complete :)');
          }).catch(function () {
            alert('Sorry, payment failed :(');
          });
          break;

        case 'confirm':
          this._header.selection = 'cart';
          this._cartView.visible = false;
          this._paymentForm.visible = false;
          this._confirmationView.visible = true;
          break;
      }
    }
  }, {
    key: 'headerController',
    set: function set(obj) {
      this._header = obj;
    }
  }, {
    key: 'cart',
    get: function get() {
      return this._cart;
    }
  }, {
    key: 'storage',
    get: function get() {
      return this._storage;
    },
    set: function set(adaptor) {
      this._storage = adaptor;
      this._cart.storage = adaptor;
    }
  }]);

  return App;
}();

exports.default = App;

},{"cart":4,"cart-view":3,"confirmation-view":5,"features":6,"header-controller":7,"idb-storage":8,"payment-api":10,"payment-form":11,"shop-view":14,"url-tools":16}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _view = require('view');

var _view2 = _interopRequireDefault(_view);

var _urlTools = require('url-tools');

var _products = require('products');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Copyright 2018 Google Inc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               */

var CartView = function (_View) {
  _inherits(CartView, _View);

  function CartView(cart) {
    var containerId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'cart';

    _classCallCheck(this, CartView);

    var _this = _possibleConstructorReturn(this, (CartView.__proto__ || Object.getPrototypeOf(CartView)).call(this, containerId));

    _this._cart = cart;
    _this._element = 'tr';
    _this._elementClass = 'product';
    _this._clickHandler = null;
    _this._tbody = _this._container.querySelector('tbody');
    _this._checkoutBtn = document.getElementById('checkoutBtn');
    return _this;
  }

  _createClass(CartView, [{
    key: 'install',
    value: function install() {
      this._clickHandler = this._handleClick.bind(this);
      this._container.addEventListener('click', this._clickHandler, true);
      // Checkout button switches hash to "pay", will cause the form to open
      this._checkoutBtn.addEventListener('click', this._goToPayment.bind(this));
    }
  }, {
    key: 'render',
    value: function render() {
      // Remove existing products
      var itemRows = this._tbody.querySelectorAll(this.itemSelector);
      for (var i = 0; i < itemRows.length; i++) {
        this._tbody.removeChild(itemRows[i]);
      }
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this._cart.cart[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var item = _step.value;

          var product = (0, _products.findProduct)(item.sku);
          var placeholder = document.createElement('tbody');
          placeholder.innerHTML = '<tr class="product" data-sku="' + product.sku + '">\n        <td class="mdl-data-table__cell-non-numeric">' + product.title + '</td>\n        <td>' + item.quantity + '</td>\n        <td>$' + product.price + '</td>\n        <td><button class="mdl-button mdl-button--colored mdl-js-button\n              mdl-js-ripple-effect mdl-button--accent delete"\n              data-sku="' + product.sku + '" data-action="remove">\n              <i class="material-icons">delete</i>remove</button>\n        </td>\n      </tr>';
          this._tbody.appendChild(placeholder.firstElementChild); // WARN: no ie8
        }
        // Add the total price
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      this.updateTotal();
    }
  }, {
    key: 'updateTotal',
    value: function updateTotal() {
      document.getElementById('cart-total').innerText = '$' + this._cart.total;
    }
  }, {
    key: 'removeFromView',
    value: function removeFromView(sku) {
      var row = this._tbody.querySelector('tr[data-sku=' + sku + ']');
      if (row) {
        row.parentNode.removeChild(row);
      }
      this.updateTotal();
    }
  }, {
    key: '_goToPayment',
    value: function _goToPayment() {
      (0, _urlTools.pushLocationHash)('pay');
    }
  }, {
    key: '_handleClick',
    value: function _handleClick(event) {
      if (event.target.dataset) {
        var sku = event.target.dataset.sku;
        var action = event.target.dataset.action;
        if (sku && action == 'remove') {
          var product = this._cart.findItem(sku);
          this._cart.remove(product);
          this.removeFromView(sku);
        }
      }
    }

    // utility for unit testing (used in counting the number of elements)

  }, {
    key: 'itemSelector',
    get: function get() {
      return this._element + '.' + this._elementClass + '[data-sku]';
    }
  }, {
    key: 'cart',
    set: function set(cart) {
      this._cart = cart;
    }
  }]);

  return CartView;
}(_view2.default);

exports.default = CartView;

},{"products":13,"url-tools":16,"view":17}],4:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LineItem = exports.CART_EVENT = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Copyright 2018 Google Inc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */

//jshint esversion: 6

var _products = require('products');

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var CART_EVENT = exports.CART_EVENT = "cartchange";

var Cart = function () {
  function Cart(adaptor, changeCallback) {
    _classCallCheck(this, Cart);

    this.items = [];
    this._storage = adaptor;
    this._loading = false;
    this._callback = changeCallback; // used to report changes back to the app
  }

  _createClass(Cart, [{
    key: 'findItem',
    value: function findItem(sku) {
      return this.items.find(function (item) {
        return item.sku === sku;
      });
    }
  }, {
    key: 'add',
    value: function add(product) {
      var quantity = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;

      if (quantity < 0 || !product) return null;
      var item = this.findItem(product.sku);
      if (item) {
        item.quantity += quantity;
      } else {
        item = new LineItem(product, quantity);
        this.items.push(item);
      }
      this._reportChange('add', product, quantity);
      return item;
    }
  }, {
    key: 'remove',
    value: function remove(product) {
      var index = this.items.findIndex(function (item) {
        return item.sku === product.sku;
      });
      if (index >= 0) {
        this.items.splice(index, 1);
      }
      this._reportChange('remove', product);
    }
  }, {
    key: 'change',
    value: function change(product, quantity) {
      var item = this.findItem(product.sku);
      if (quantity <= 0) {
        this.remove(item);
        this._reportChange('remove', product);
        return null;
      } else {
        item.quantity = quantity;
        this._reportChange('change', product, quantity);
        return item;
      }
    }
  }, {
    key: 'reset',
    value: function reset() {
      this.items = [];
      this._reportChange('reset');
    }
  }, {
    key: 'save',
    value: function save() {
      if (!this._storage) return;
      return this._storage.save(this.items.map(function (item) {
        return item.savedValue;
      }));
    }
  }, {
    key: 'load',
    value: function load() {
      var _this = this;

      if (!this._storage) return;
      this._loading = true;
      return this._storage.load().then(function (loadedItems) {
        _this.items = loadedItems.map(function (s) {
          var li = new LineItem();li.savedValue = s;return li;
        });
      }).catch(function (e) {
        _this.items = [];
      }).then(function () {
        _this._loading = false;
        _this._reportChange('load');
        return _this.items;
      });
    }
  }, {
    key: '_reportChange',
    value: function _reportChange(action, product, quantity) {
      if (this._loading) return; // don't spam the app with events
      var details = { 'action': action, 'total': this.total };
      if (product) details.sku = product.sku;
      if (quantity) details.quantity = quantity;
      if (this._callback) this._callback(details);
    }
  }, {
    key: 'length',
    get: function get() {
      return this.items.length;
    }
  }, {
    key: 'count',
    get: function get() {
      var count = 0;
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this.items[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var item = _step.value;

          count += item.quantity;
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      return count;
    }
  }, {
    key: 'total',
    get: function get() {
      var total = 0;
      var _iteratorNormalCompletion2 = true;
      var _didIteratorError2 = false;
      var _iteratorError2 = undefined;

      try {
        for (var _iterator2 = this.items[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
          var item = _step2.value;

          total += item.total;
        }
      } catch (err) {
        _didIteratorError2 = true;
        _iteratorError2 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion2 && _iterator2.return) {
            _iterator2.return();
          }
        } finally {
          if (_didIteratorError2) {
            throw _iteratorError2;
          }
        }
      }

      return total;
    }
  }, {
    key: 'cart',
    get: function get() {
      return this.items;
    }
  }]);

  return Cart;
}();

exports.default = Cart;

var LineItem = exports.LineItem = function () {
  function LineItem(product, quantity) {
    _classCallCheck(this, LineItem);

    if (product == null) {
      this._sku = null;
      this._price = this._quantity = 0;
    } else {
      this._sku = product.sku;
      this._price = product.price;
      this._quantity = quantity;
    }
  }

  _createClass(LineItem, [{
    key: 'sku',
    get: function get() {
      return this._sku;
    }
  }, {
    key: 'price',
    get: function get() {
      return this._price;
    }
  }, {
    key: 'total',
    get: function get() {
      return this._quantity * this._price;
    }
  }, {
    key: 'quantity',
    get: function get() {
      return this._quantity;
    },
    set: function set(value) {
      this._quantity = value < 0 ? 0 : value;
    }

    // Only save minimal information (to conserve space & prevent spoofing)

  }, {
    key: 'savedValue',
    get: function get() {
      return { sku: this._sku, qty: this._quantity };
    },
    set: function set(value) {
      var product = (0, _products.findProduct)(value.sku);
      if (!product) throw new Error('SKU not found: ' + value.sku);
      this._sku = value.sku;
      this._quantity = value.qty;
      this._price = product.price;
    }
  }, {
    key: 'storage',
    set: function set(adaptor) {
      this._storage = adaptor;
    }
  }]);

  return LineItem;
}();

},{"products":13}],5:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _view = require('view');

var _view2 = _interopRequireDefault(_view);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Copyright 2018 Google Inc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               */

var ConfirmationView = function (_View) {
  _inherits(ConfirmationView, _View);

  function ConfirmationView() {
    var containerId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'confirmation';

    _classCallCheck(this, ConfirmationView);

    var _this = _possibleConstructorReturn(this, (ConfirmationView.__proto__ || Object.getPrototypeOf(ConfirmationView)).call(this, containerId));

    _this._requestData = '';
    _this._responseData = '';
    _this._requestDiv = document.getElementById('requestData');
    _this._responseDiv = document.getElementById('responseData');
    // this._clickHandler = null;
    // this._checkoutBtn = document.getElementById('checkoutBtn');
    return _this;
  }

  _createClass(ConfirmationView, [{
    key: 'install',
    value: function install() {
      // this._clickHandler = this._handleClick.bind(this);
      // this._container.addEventListener('click', this._clickHandler, true);
    }
  }, {
    key: 'render',
    value: function render() {
      this._requestDiv.innerText = this._requestData;
      this._responseDiv.innerText = this._responseData;
    }
  }, {
    key: 'requestData',
    set: function set(value) {
      this._requestData = value === null ? '' : value;
      this._render();
    }
  }, {
    key: 'responseData',
    set: function set(value) {
      this._responseData = value === null ? '' : value;
      this._render();
    }
  }]);

  return ConfirmationView;
}(_view2.default);

exports.default = ConfirmationView;

},{"view":17}],6:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.hasPrerequisites = hasPrerequisites;
exports.hasLocalStorage = hasLocalStorage;
exports.hasIndexedDB = hasIndexedDB;
exports.hasPaymentRequest = hasPaymentRequest;
/*
Copyright 2018 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

function hasPrerequisites() {
  var hasStorage = hasLocalStorage() || hasIndexedDB();
  // firstElementChild not in ie8
  var hasFirstElementChild = 'firstElementChild' in document;
  return hasStorage & hasFirstElementChild;
}

function hasLocalStorage() {
  return 'LocalStorage' in window;
}

function hasIndexedDB() {
  return 'indexedDB' in window;
}

function hasPaymentRequest() {
  return 'PaymentRequest' in window;
}

},{}],7:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/*
Copyright 2018 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

//jshint esversion: 6
var HeaderController = function () {
  function HeaderController() {
    var containerId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'headers';

    _classCallCheck(this, HeaderController);

    this._containerId = containerId;
    this._selection = 'shop';
    this._count = 0;
  }

  _createClass(HeaderController, [{
    key: 'selection',
    get: function get() {
      return this._selection;
    },
    set: function set(newValue) {
      if (newValue != 'shop' && newValue != 'cart') return;
      if (newValue == this._selection) return;
      this._selection = newValue;

      // Now update the UI
      var container = document.getElementById(this._containerId);
      // Only two kinds of links, so flip active
      var links = container.querySelectorAll('a.mdl-navigation__link');
      for (var i = 0; i < links.length; i++) {
        links[i].classList.toggle('is-active');
      }
    }
  }, {
    key: 'count',
    get: function get() {
      return this._count;
    },
    set: function set(newCount) {
      if (this._count == newCount) return;
      // TODO use a badge instead
      var label = newCount === 0 ? '' : ' (' + newCount + ' items)';
      this._count = newCount;
      var spans = document.querySelectorAll('#' + this._containerId + ' a[href="#cart"]');
      for (var i = 0; i < spans.length; i++) {
        spans[i].innerText = 'Cart' + label;
      }
    }
  }]);

  return HeaderController;
}();

exports.default = HeaderController;

},{}],8:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Copyright 2018 Google Inc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */

var _idb = require('idb');

var idb = _interopRequireWildcard(_idb);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var CART_STORE = 'cart';
var RW = 'readwrite';

var IDBStorage = function () {
  function IDBStorage() {
    var id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'mfs-cart-items';

    _classCallCheck(this, IDBStorage);

    this._id = id;
    this._open();
  }

  /* Takes an array of items and writes JSON to local storage */


  _createClass(IDBStorage, [{
    key: 'save',
    value: function save(items) {
      return this._dbPromise.then(function (db) {
        var tx = db.transaction(CART_STORE, RW);
        var store = tx.objectStore(CART_STORE);
        return store.clear().then(function () {
          var addAll = items.map(function (item) {
            return store.add({ sku: item.sku, qty: item.qty });
          });
          return Promise.all(addAll);
        }).then(function () {
          return tx.complete;
        });
      });
    }
  }, {
    key: 'load',
    value: function load() {
      return this._dbPromise.then(function (db) {
        return db.transaction(CART_STORE, RW).objectStore(CART_STORE).getAll();
      });
    }
  }, {
    key: 'delete',
    value: function _delete() {}
    //    localStorage.removeItem(this._id);


    // Returns a promise with the total number of records saved

  }, {
    key: 'count',
    value: function count() {
      return this._dbPromise.then(function (db) {
        var tx = db.transaction(CART_STORE);
        return tx.objectStore(CART_STORE).count();
      });
    }

    // Testing use only, will close the dabase but renders the adaptor unusable

  }, {
    key: '_close',
    value: function _close() {
      var _this = this;

      return this._dbPromise.then(function (db) {
        var closePromise = db.close();
        _this._dbPromise = null;
        return closePromise;
      });
    }
  }, {
    key: '_open',
    value: function _open() {
      return this._dbPromise = idb.open(this._id, 1, function (upgradeDB) {
        upgradeDB.createObjectStore(CART_STORE, { autoIncrement: true });
      });
    }

    // testing hooks so we can test w/o wrecking the stored data

  }, {
    key: 'key',
    set: function set(value) {
      var _this2 = this;

      if (value === this._id) return;
      this._close().then(function () {
        _this2._id = value;
        _this2._open();
      });
    },
    get: function get() {
      return this._id;
    }
  }, {
    key: 'storage',
    get: function get() {
      return this._dbPromise;
    }
  }]);

  return IDBStorage;
}();

exports.default = IDBStorage;

},{"idb":18}],9:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = sendToServer;
/*
Copyright 2018 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

/*
 * Simple server fetch function that only send a request to /checkout
 * and returns `true` or throws an exception.
 */
function sendToServer(data) {
  return fetch('/checkout/', {
    method: 'POST',
    credentials: 'include',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  }).then(function (res) {
    if (res.status !== 200) {
      throw new Error('Payment failure (id ' + res.status + ')');
    }
    return true;
  });
}

},{}],10:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Copyright 2018 Google Inc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */

var _merchantServer = require('merchant-server');

var _merchantServer2 = _interopRequireDefault(_merchantServer);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var SHIPPING_OPTIONS = {
  us: [{
    id: 'standard',
    label: 'Standard Shipping',
    price: 0
  }, {
    id: 'express',
    label: 'Express Shipping',
    price: 10
  }],
  international: [{
    id: 'international',
    label: 'International Shipping',
    price: 15
  }]
};

var PAYMENT_METHODS = [];

var PaymentAPIWrapper = function () {
  function PaymentAPIWrapper() {
    _classCallCheck(this, PaymentAPIWrapper);
  }

  _createClass(PaymentAPIWrapper, [{
    key: 'checkout',


    /*
    * Given a cart set up with an order, gets payment authorization.
    * Returns a promise that resolves when payment is complete, this
    * has a data object you can pass to the back-end payment server.
    */
    value: function checkout(cart) {
      var request = this.buildPaymentRequest(cart);
      var response = void 0;
      // Show UI then continue with user payment info
      return request.show().then(function (r) {
        // The UI will show a spinner to the user until
        // `request.complete()` is called.
        response = r;
        var data = r.toJSON();
        console.log(data);
        return data;
      }).then(function (data) {
        return (0, _merchantServer2.default)(data);
      }).then(function () {
        response.complete('success');
        return response;
      }).catch(function (e) {
        if (response) {
          console.error(e);
          response.complete('fail');
        } else if (e.code !== e.ABORT_ERR) {
          console.error(e);
          throw e;
        } else {
          return null;
        }
      });
    }

    /*
     * Creates a PaymentRequest object including the event handlers used to
     * update the payment details as the user makes choices.
     */

  }, {
    key: 'buildPaymentRequest',
    value: function buildPaymentRequest(cart) {
      var _this = this;

      // Supported payment instruments
      var supportedInstruments = [{
        supportedMethods: ['basic-card'],
        data: {
          supportedNetworks: ['visa', 'mastercard', 'amex', 'jcb', 'diners', 'discover', 'mir', 'unionpay']
        }
      }];

      // Payment options
      var paymentOptions = {
        requestShipping: true,
        requestPayerEmail: true,
        requestPayerPhone: true,
        requestPayerName: true
      };

      var shippingOptions = [];
      var selectedOption = null;

      var details = this.buildPaymentDetails(cart, shippingOptions, selectedOption);

      // Initialize
      var request = new PaymentRequest(supportedInstruments, details, paymentOptions);

      // When user selects a shipping address, add shipping options to match
      request.addEventListener('shippingaddresschange', function (e) {
        e.updateWith(function (_) {
          // Get the shipping options and select the least expensive
          shippingOptions = _this.optionsForCountry(request.shippingAddress.country);
          selectedOption = shippingOptions[0].id;
          var details = _this.buildPaymentDetails(cart, shippingOptions, selectedOption);
          return Promise.resolve(details);
        }());
      });

      // When user selects a shipping option, update cost, etc. to match
      request.addEventListener('shippingoptionchange', function (e) {
        e.updateWith(function (_) {
          selectedOption = request.shippingOption;
          var details = _this.buildPaymentDetails(cart, shippingOptions, selectedOption);
          return Promise.resolve(details);
        }());
      });

      return request;
    }

    /*
     * Creates the PaymentDetails dictionary inside the PaymentRequest.
     * This can change as the user selects shipping options.
     */

  }, {
    key: 'buildPaymentDetails',
    value: function buildPaymentDetails(cart, shippingOptions, shippingOptionId) {
      // Start with the cart items
      var displayItems = cart.cart.map(function (item) {
        return {
          label: item.sku + ': ' + item.quantity + 'x $' + item.price,
          amount: { currency: 'USD', value: String(item.total) }
        };
      });
      var total = cart.total;

      var displayedShippingOptions = [];
      if (shippingOptions.length > 0) {
        var selectedOption = shippingOptions.find(function (option) {
          return option.id === shippingOptionId;
        });
        displayedShippingOptions = shippingOptions.map(function (option) {
          return {
            id: option.id,
            label: option.label,
            amount: { currency: 'USD', value: String(option.price) },
            selected: option.id === shippingOptionId
          };
        });
        if (selectedOption) total += selectedOption.price;
      }

      var details = {
        displayItems: displayItems,
        total: {
          label: 'Total due',
          amount: { currency: 'USD', value: String(total) }
        },
        shippingOptions: displayedShippingOptions
      };

      return details;
    }

    /*
     * Utility function to extract the correct shipping options for a country.
     */

  }, {
    key: 'optionsForCountry',
    value: function optionsForCountry(country) {
      country = country.toLowerCase();
      if (!country || !SHIPPING_OPTIONS.hasOwnProperty(country)) {
        country = 'international';
      }
      var options = SHIPPING_OPTIONS[country];
      // Sort by price, lowest first
      options.sort(function (a, b) {
        return a.price - b.price;
      });
      return options;
    }
  }]);

  return PaymentAPIWrapper;
}();

exports.default = PaymentAPIWrapper;

},{"merchant-server":9}],11:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _view = require('view');

var _view2 = _interopRequireDefault(_view);

var _merchantServer = require('merchant-server');

var _merchantServer2 = _interopRequireDefault(_merchantServer);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Copyright 2018 Google Inc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               */

var PaymentForm = function (_View) {
  _inherits(PaymentForm, _View);

  function PaymentForm(cart, confirmationView) {
    var containerId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'payment';

    _classCallCheck(this, PaymentForm);

    var _this = _possibleConstructorReturn(this, (PaymentForm.__proto__ || Object.getPrototypeOf(PaymentForm)).call(this, containerId));

    _this._checkoutForm = document.getElementById('payment_form');
    _this._cart = cart;
    _this._confirmationView = confirmationView;
    _this._promise = null;
    return _this;
  }

  /*
   * Performs the checkout using the form. Returns a promise that resolves when
   * the user checks out.
   */


  _createClass(PaymentForm, [{
    key: 'checkout',
    value: function checkout() {
      var _this2 = this;

      // TODO how do we handle cart abandonment?
      var self = this;
      this.visible = true;
      this._promise = new Promise(function (resolve, reject) {
        _this2._checkoutForm.addEventListener('submit', function temp(event) {
          event.preventDefault();
          var data = new FormData(event.target);
          self._showRequest(data);
          return Promise.resolve(data).then(_merchantServer2.default).then(function (json) {
            self._showResponse(json);
            resolve(json);
          }).catch(function (e) {
            return reject(e);
          }).then(function () {
            return self._checkoutForm.removeEventListener('submit', temp);
          });
        });
      });
      return this._promise;
    }
  }, {
    key: 'abort',
    value: function abort() {
      this._promise.reject('aborted');
    }
  }, {
    key: '_showRequest',
    value: function _showRequest(formData) {
      if (this._confirmationView) {
        this._confirmationView.requestData = this._toJSON(formData);
      }
    }
  }, {
    key: '_showResponse',
    value: function _showResponse(json) {
      if (this._confirmationView) {
        this._confirmationView.responseData = json;
      }
    }
  }, {
    key: '_toJSON',
    value: function _toJSON(formData) {
      var obj = {};
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = formData[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var entry = _step.value;

          obj[entry.key] = entry.value;
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      return JSON.stringify(obj);
    }
  }]);

  return PaymentForm;
}(_view2.default);

exports.default = PaymentForm;

},{"merchant-server":9,"view":17}],12:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/*
Copyright 2018 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

//jshint esversion: 6

var Product = function () {
  function Product(sku, title, price, image) {
    var description = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : '';

    _classCallCheck(this, Product);

    this._sku = sku;
    this._title = title;
    this._price = price;
    this._image = image;
    this._description = description;
  }

  _createClass(Product, [{
    key: 'sku',
    get: function get() {
      return this._sku;
    }
  }, {
    key: 'title',
    get: function get() {
      return this._title;
    }
  }, {
    key: 'price',
    get: function get() {
      return this._price;
    }
  }, {
    key: 'image',
    get: function get() {
      return this._image;
    }
  }, {
    key: 'description',
    get: function get() {
      return this._description;
    }
  }]);

  return Product;
}();

exports.default = Product;

},{}],13:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.products = undefined;
exports.findProduct = findProduct;

var _product = require('product');

var _product2 = _interopRequireDefault(_product);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

//   constructor (sku, title, price, image, description='') {

// Normally you would get these from a server
var products = exports.products = [new _product2.default('BarrelChair', 'Barrel Chair', 100.00, 'BarrelChair.jpg', 'A beautiful chair made of upcycled barrel staves'), new _product2.default('C10', 'C10 Chair', 100.00, 'C10.jpg', 'A colorful chair with modern style and flair'), new _product2.default('Cl2', 'CL2 Chair', 100.00, 'Cl2.jpg', 'A comfortable extended chair made for lounging'), new _product2.default('CP03_blue', 'CP03 Chair', 100.00, 'CP03_blue.jpg', 'A wide cushion you can stack or move around the floor'), new _product2.default('CPC_RECYCLED', 'CPC Upcycled', 100.00, 'CPC_RECYCLED.jpg', 'A simple chair with a seat of recycled plastic'), new _product2.default('CPFS', 'CPFS', 100.00, 'CPFS.jpg', 'A footstool mader to complement the CPFS chair'), new _product2.default('CPO2_red', 'CPO2', 100.00, 'CPO2_red.jpg', 'A narrow cushion, smaller than CP03, and quite comfortable'), new _product2.default('CPT', 'CPT Table', 100.00, 'CPT.jpg', 'A perfect table for outdoors, has a hole for an umbrella'), new _product2.default('CS1', 'CS1 Sofa', 100.00, 'CS1.jpg', 'A soft, stylish, and colorful sofa. Perfect for your home')]; /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Copyright 2018 Google Inc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  */
function findProduct(sku) {
  var searchRange = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : products;

  return searchRange.find(function (product) {
    return product.sku === sku;
  });
}

},{"product":12}],14:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _view = require('view');

var _view2 = _interopRequireDefault(_view);

var _products = require('products');

var _snackbar = require('snackbar');

var _snackbar2 = _interopRequireDefault(_snackbar);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Copyright 2018 Google Inc.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               */

var ShopView = function (_View) {
  _inherits(ShopView, _View);

  function ShopView(cart) {
    var productSelection = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _products.products;
    var containerId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'shop';

    _classCallCheck(this, ShopView);

    var _this = _possibleConstructorReturn(this, (ShopView.__proto__ || Object.getPrototypeOf(ShopView)).call(this, containerId, true));

    _this._cart = cart;
    _this._products = productSelection;
    _this._element = 'div';
    _this._elementClass = 'product';
    _this._addHandler = null;
    return _this;
  }

  _createClass(ShopView, [{
    key: 'install',
    value: function install() {
      // Capture add events (clicks) as they bubble up. Only add once.
      this._addHandler = this._handleProductClick.bind(this);
      this._container.addEventListener('click', this._addHandler, false);
    }
  }, {
    key: 'render',
    value: function render() {
      this._container.innerHTML = ''; // remove all children
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this._products[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var product = _step.value;

          var placeholder = document.createElement('div');
          placeholder.innerHTML = '<div class="mdl-cell mdl-card mdl-shadow--4dp portfolio-card product">\n        <div class="mdl-card__media">\n          <img class="article-image" src=" images/products/' + product.image + '" border="0" alt="">\n        </div>\n        <div class="mdl-card__title">\n          <h2 class="mdl-card__title-text">' + product.title + '</h2>\n        </div>\n        <div class="mdl-card__supporting-text">\n          ' + product.description + '\n        </div>\n        <div class="mdl-card__actions mdl-card--border">\n          <button class="mdl-button mdl-button--colored mdl-js-button\n            mdl-js-ripple-effect mdl-button--accent add-to-cart"\n            data-sku="' + product.sku + '">\n            <i class="material-icons">add_shopping_cart</i>Add to Cart\n          </button>\n        </div>\n      </div>';
          this._container.appendChild(placeholder.firstElementChild); // WARN: no ie8
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }
  }, {
    key: '_handleProductClick',
    value: function _handleProductClick(event) {
      event.preventDefault();
      // MDL inserts an animated span as a child of the button; it gets the click.
      // We may need to look at the parent to find the button.
      var target = event.target;
      if (!target || target == this._container) return;
      while (target.nodeName != 'BUTTON') {
        if (!target.parentNode) break;
        target = target.parentNode;
      }
      if (!target.dataset) return;
      var sku = target.dataset.sku;
      if (!sku) throw new Error('could not find sku, data- attrs not supported?');
      var product = (0, _products.findProduct)(sku, this._products);
      this._cart.add(product);
      this._showConfirmation(product);
    }
  }, {
    key: '_showConfirmation',
    value: function _showConfirmation(product) {
      (0, _snackbar2.default)(product.sku + ' added to cart');
    }

    // utility for unit testing (used in counting the number of elements)

  }, {
    key: 'itemSelector',
    get: function get() {
      return this._element + '.' + this._elementClass;
    }
  }]);

  return ShopView;
}(_view2.default);

exports.default = ShopView;

},{"products":13,"snackbar":15,"view":17}],15:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = showToast;
/*
Copyright 2018 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

//jshint esversion: 6

// Pop up a user notification
function showToast(message) {
  var notification = document.getElementById('snackbar');
  if (notification && 'MaterialSnackbar' in notification) {
    notification.MaterialSnackbar.showSnackbar({ message: message });
  }
}

},{}],16:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.replaceLocationHash = replaceLocationHash;
exports.pushLocationHash = pushLocationHash;
/*
Copyright 2018 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

//jshint esversion: 6
function replaceLocationHash(hash) {
  var baseUrl = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window.location;

  var url = urlWithHash(hash, baseUrl);
  history.replaceState({}, "", url);
}

function pushLocationHash(hash) {
  var baseUrl = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window.location;

  window.location = urlWithHash(hash, baseUrl);
}

function urlWithHash(hash, baseUrl) {
  var url = baseUrl.toString();
  var index = url.indexOf('#');
  if (index >= 0) url = url.substring(0, index);
  return url + '#' + hash;
};

},{}],17:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/*
Copyright 2018 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

var View = function () {
  function View(containerId) {
    var renderBeforeVisible = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

    _classCallCheck(this, View);

    this._containerId = containerId;
    this._container = document.getElementById(this._containerId);
    this._needsRender = renderBeforeVisible;
  }

  _createClass(View, [{
    key: 'render',
    value: function render() {
      // override this
    }
  }, {
    key: 'visible',
    set: function set(vis) {
      if (vis && !this.visible && this._needsRender) {
        // becoming visible, update
        this.render();
      }
      if (vis) {
        this._container.removeAttribute('hidden');
      } else {
        this._container.setAttribute('hidden', true);
      }
    },
    get: function get() {
      return !this._container.hasAttribute('hidden');
    }
  }]);

  return View;
}();

exports.default = View;

},{}],18:[function(require,module,exports){
'use strict';

(function() {
  function toArray(arr) {
    return Array.prototype.slice.call(arr);
  }

  function promisifyRequest(request) {
    return new Promise(function(resolve, reject) {
      request.onsuccess = function() {
        resolve(request.result);
      };

      request.onerror = function() {
        reject(request.error);
      };
    });
  }

  function promisifyRequestCall(obj, method, args) {
    var request;
    var p = new Promise(function(resolve, reject) {
      request = obj[method].apply(obj, args);
      promisifyRequest(request).then(resolve, reject);
    });

    p.request = request;
    return p;
  }
  
  function promisifyCursorRequestCall(obj, method, args) {
    var p = promisifyRequestCall(obj, method, args);
    return p.then(function(value) {
      if (!value) return;
      return new Cursor(value, p.request);
    });
  }

  function proxyProperties(ProxyClass, targetProp, properties) {
    properties.forEach(function(prop) {
      Object.defineProperty(ProxyClass.prototype, prop, {
        get: function() {
          return this[targetProp][prop];
        },
        set: function(val) {
          this[targetProp][prop] = val;
        }
      });
    });
  }

  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {
    properties.forEach(function(prop) {
      if (!(prop in Constructor.prototype)) return;
      ProxyClass.prototype[prop] = function() {
        return promisifyRequestCall(this[targetProp], prop, arguments);
      };
    });
  }

  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {
    properties.forEach(function(prop) {
      if (!(prop in Constructor.prototype)) return;
      ProxyClass.prototype[prop] = function() {
        return this[targetProp][prop].apply(this[targetProp], arguments);
      };
    });
  }

  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {
    properties.forEach(function(prop) {
      if (!(prop in Constructor.prototype)) return;
      ProxyClass.prototype[prop] = function() {
        return promisifyCursorRequestCall(this[targetProp], prop, arguments);
      };
    });
  }

  function Index(index) {
    this._index = index;
  }

  proxyProperties(Index, '_index', [
    'name',
    'keyPath',
    'multiEntry',
    'unique'
  ]);

  proxyRequestMethods(Index, '_index', IDBIndex, [
    'get',
    'getKey',
    'getAll',
    'getAllKeys',
    'count'
  ]);

  proxyCursorRequestMethods(Index, '_index', IDBIndex, [
    'openCursor',
    'openKeyCursor'
  ]);

  function Cursor(cursor, request) {
    this._cursor = cursor;
    this._request = request;
  }

  proxyProperties(Cursor, '_cursor', [
    'direction',
    'key',
    'primaryKey',
    'value'
  ]);

  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [
    'update',
    'delete'
  ]);

  // proxy 'next' methods
  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {
    if (!(methodName in IDBCursor.prototype)) return;
    Cursor.prototype[methodName] = function() {
      var cursor = this;
      var args = arguments;
      return Promise.resolve().then(function() {
        cursor._cursor[methodName].apply(cursor._cursor, args);
        return promisifyRequest(cursor._request).then(function(value) {
          if (!value) return;
          return new Cursor(value, cursor._request);
        });
      });
    };
  });

  function ObjectStore(store) {
    this._store = store;
  }

  ObjectStore.prototype.createIndex = function() {
    return new Index(this._store.createIndex.apply(this._store, arguments));
  };

  ObjectStore.prototype.index = function() {
    return new Index(this._store.index.apply(this._store, arguments));
  };

  proxyProperties(ObjectStore, '_store', [
    'name',
    'keyPath',
    'indexNames',
    'autoIncrement'
  ]);

  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [
    'put',
    'add',
    'delete',
    'clear',
    'get',
    'getAll',
    'getKey',
    'getAllKeys',
    'count'
  ]);

  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [
    'openCursor',
    'openKeyCursor'
  ]);

  proxyMethods(ObjectStore, '_store', IDBObjectStore, [
    'deleteIndex'
  ]);

  function Transaction(idbTransaction) {
    this._tx = idbTransaction;
    this.complete = new Promise(function(resolve, reject) {
      idbTransaction.oncomplete = function() {
        resolve();
      };
      idbTransaction.onerror = function() {
        reject(idbTransaction.error);
      };
      idbTransaction.onabort = function() {
        reject(idbTransaction.error);
      };
    });
  }

  Transaction.prototype.objectStore = function() {
    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));
  };

  proxyProperties(Transaction, '_tx', [
    'objectStoreNames',
    'mode'
  ]);

  proxyMethods(Transaction, '_tx', IDBTransaction, [
    'abort'
  ]);

  function UpgradeDB(db, oldVersion, transaction) {
    this._db = db;
    this.oldVersion = oldVersion;
    this.transaction = new Transaction(transaction);
  }

  UpgradeDB.prototype.createObjectStore = function() {
    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));
  };

  proxyProperties(UpgradeDB, '_db', [
    'name',
    'version',
    'objectStoreNames'
  ]);

  proxyMethods(UpgradeDB, '_db', IDBDatabase, [
    'deleteObjectStore',
    'close'
  ]);

  function DB(db) {
    this._db = db;
  }

  DB.prototype.transaction = function() {
    return new Transaction(this._db.transaction.apply(this._db, arguments));
  };

  proxyProperties(DB, '_db', [
    'name',
    'version',
    'objectStoreNames'
  ]);

  proxyMethods(DB, '_db', IDBDatabase, [
    'close'
  ]);

  // Add cursor iterators
  // TODO: remove this once browsers do the right thing with promises
  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {
    [ObjectStore, Index].forEach(function(Constructor) {
      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {
        var args = toArray(arguments);
        var callback = args[args.length - 1];
        var nativeObject = this._store || this._index;
        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));
        request.onsuccess = function() {
          callback(request.result);
        };
      };
    });
  });

  // polyfill getAll
  [Index, ObjectStore].forEach(function(Constructor) {
    if (Constructor.prototype.getAll) return;
    Constructor.prototype.getAll = function(query, count) {
      var instance = this;
      var items = [];

      return new Promise(function(resolve) {
        instance.iterateCursor(query, function(cursor) {
          if (!cursor) {
            resolve(items);
            return;
          }
          items.push(cursor.value);

          if (count !== undefined && items.length == count) {
            resolve(items);
            return;
          }
          cursor.continue();
        });
      });
    };
  });

  var exp = {
    open: function(name, version, upgradeCallback) {
      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);
      var request = p.request;

      request.onupgradeneeded = function(event) {
        if (upgradeCallback) {
          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));
        }
      };

      return p.then(function(db) {
        return new DB(db);
      });
    },
    delete: function(name) {
      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);
    }
  };

  if (typeof module !== 'undefined') {
    module.exports = exp;
  }
  else {
    self.idb = exp;
  }
}());

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHAvc2NyaXB0cy9tYWluLmpzIiwiYXBwL3NjcmlwdHMvbW9kdWxlcy9hcHAuanMiLCJhcHAvc2NyaXB0cy9tb2R1bGVzL2NhcnQtdmlldy5qcyIsImFwcC9zY3JpcHRzL21vZHVsZXMvY2FydC5qcyIsImFwcC9zY3JpcHRzL21vZHVsZXMvY29uZmlybWF0aW9uLXZpZXcuanMiLCJhcHAvc2NyaXB0cy9tb2R1bGVzL2ZlYXR1cmVzLmpzIiwiYXBwL3NjcmlwdHMvbW9kdWxlcy9oZWFkZXItY29udHJvbGxlci5qcyIsImFwcC9zY3JpcHRzL21vZHVsZXMvaWRiLXN0b3JhZ2UuanMiLCJhcHAvc2NyaXB0cy9tb2R1bGVzL21lcmNoYW50LXNlcnZlci5qcyIsImFwcC9zY3JpcHRzL21vZHVsZXMvcGF5bWVudC1hcGkuanMiLCJhcHAvc2NyaXB0cy9tb2R1bGVzL3BheW1lbnQtZm9ybS5qcyIsImFwcC9zY3JpcHRzL21vZHVsZXMvcHJvZHVjdC5qcyIsImFwcC9zY3JpcHRzL21vZHVsZXMvcHJvZHVjdHMuanMiLCJhcHAvc2NyaXB0cy9tb2R1bGVzL3Nob3Atdmlldy5qcyIsImFwcC9zY3JpcHRzL21vZHVsZXMvc25hY2tiYXIuanMiLCJhcHAvc2NyaXB0cy9tb2R1bGVzL3VybC10b29scy5qcyIsImFwcC9zY3JpcHRzL21vZHVsZXMvdmlldy5qcyIsIm5vZGVfbW9kdWxlcy9pZGIvbGliL2lkYi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDcUJBOzs7O0FBQ0E7Ozs7QUF0QkE7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtCQTtBQUNBOztBQUtBLENBQUMsWUFBTTtBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLE1BQU0sY0FBYyxRQUFRLE9BQU8sUUFBUCxDQUFnQixRQUFoQixLQUE2QixXQUE3QjtBQUN4QjtBQUNBLFNBQU8sUUFBUCxDQUFnQixRQUFoQixLQUE2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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIvKiFcclxuICpcclxuICogIFdlYiBTdGFydGVyIEtpdFxyXG4gKiAgQ29weXJpZ2h0IDIwMTggR29vZ2xlIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgaHR0cHM6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZVxyXG4gKlxyXG4gKi9cclxuLyogZXNsaW50LWVudiBicm93c2VyICovXHJcbi8vIGpzaGludCBlc3ZlcnNpb246IDZcclxuXHJcbmltcG9ydCBBcHAgZnJvbSAnYXBwJztcclxuaW1wb3J0IHtoYXNQcmVyZXF1aXNpdGVzfSBmcm9tICdmZWF0dXJlcyc7XHJcblxyXG4oKCkgPT4ge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgLy8gQ2hlY2sgdG8gbWFrZSBzdXJlIHNlcnZpY2Ugd29ya2VycyBhcmUgc3VwcG9ydGVkIGluIHRoZSBjdXJyZW50IGJyb3dzZXIsXHJcbiAgLy8gYW5kIHRoYXQgdGhlIGN1cnJlbnQgcGFnZSBpcyBhY2Nlc3NlZCBmcm9tIGEgc2VjdXJlIG9yaWdpbi4gVXNpbmcgYVxyXG4gIC8vIHNlcnZpY2Ugd29ya2VyIGZyb20gYW4gaW5zZWN1cmUgb3JpZ2luIHdpbGwgdHJpZ2dlciBKUyBjb25zb2xlIGVycm9ycy4gU2VlXHJcbiAgLy8gaHR0cDovL3d3dy5jaHJvbWl1bS5vcmcvSG9tZS9jaHJvbWl1bS1zZWN1cml0eS9wcmVmZXItc2VjdXJlLW9yaWdpbnMtZm9yLXBvd2VyZnVsLW5ldy1mZWF0dXJlc1xyXG4gIGNvbnN0IGlzTG9jYWxob3N0ID0gQm9vbGVhbih3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09ICdsb2NhbGhvc3QnIHx8XHJcbiAgICAgIC8vIFs6OjFdIGlzIHRoZSBJUHY2IGxvY2FsaG9zdCBhZGRyZXNzLlxyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09ICdbOjoxXScgfHxcclxuICAgICAgLy8gMTI3LjAuMC4xLzggaXMgY29uc2lkZXJlZCBsb2NhbGhvc3QgZm9yIElQdjQuXHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZS5tYXRjaChcclxuICAgICAgICAvXjEyNyg/OlxcLig/OjI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPykpezN9JC9cclxuICAgICAgKVxyXG4gICAgKTtcclxuXHJcbiAgLy8gUmVnaXN0ZXIgdGhlIHNlcnZpY2Ugd29ya2VyXHJcbiAgaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xyXG4gICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc3cuanMnKVxyXG4gICAgICAgIC50aGVuKHJlZ2lzdHJhdGlvbiA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnU2VydmljZSBXb3JrZXIgcmVnaXN0ZXJlZCEnKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ1JlZ2lzdHJhdGlvbiBmYWlsZWQgOignKTtcclxuICAgICAgICB9KVxyXG4gICAgfSk7ICAgICAgIFxyXG4gIH1cclxuXHJcbiAgLy8gSW5pdGlhbGl6ZSBhcHBcclxuICBsZXQgYXBwID0gbmV3IEFwcCgpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XHJcbiAgICBpZiAoIWhhc1ByZXJlcXVpc2l0ZXMoKSkge1xyXG4gICAgICB3aW5kb3cuYWxlcnQoJ1RoaXMgYnJvd3NlciBpcyBtaXNzaW5nIHNvbWUgcmVxdWlyZWQgZmVhdHVyZXMnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgYXBwLmluc3RhbGwoKTtcclxuICAgIGFwcC5ydW4oKTtcclxuICB9KTtcclxufSkoKTtcclxuIiwiLypcclxuQ29weXJpZ2h0IDIwMTggR29vZ2xlIEluYy5cclxuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcblxyXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiovXHJcblxyXG5pbXBvcnQgQ2FydCBmcm9tICdjYXJ0JztcclxuaW1wb3J0IElEQlN0b3JhZ2UgZnJvbSAnaWRiLXN0b3JhZ2UnO1xyXG5pbXBvcnQgTG9jYWxTdG9yYWdlIGZyb20gJ2lkYi1zdG9yYWdlJztcclxuaW1wb3J0IENhcnRWaWV3IGZyb20gJ2NhcnQtdmlldyc7XHJcbmltcG9ydCBTaG9wVmlldyBmcm9tICdzaG9wLXZpZXcnO1xyXG5pbXBvcnQgUGF5bWVudEZvcm0gZnJvbSAncGF5bWVudC1mb3JtJztcclxuaW1wb3J0IFBheW1lbnRBUElXcmFwcGVyIGZyb20gJ3BheW1lbnQtYXBpJztcclxuaW1wb3J0IENvbmZpcm1hdGlvblZpZXcgZnJvbSAnY29uZmlybWF0aW9uLXZpZXcnO1xyXG5pbXBvcnQgSGVhZGVyQ29udHJvbGxlciBmcm9tICdoZWFkZXItY29udHJvbGxlcic7XHJcbmltcG9ydCB7cmVwbGFjZUxvY2F0aW9uSGFzaH0gZnJvbSAndXJsLXRvb2xzJztcclxuaW1wb3J0ICogYXMgZmVhdHVyZXMgZnJvbSAnZmVhdHVyZXMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBwIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLl9zdG9yYWdlID0gZmVhdHVyZXMuaGFzSW5kZXhlZERCID8gbmV3IElEQlN0b3JhZ2UoKSA6IG5ldyBMb2NhbFN0b3JhZ2UoKTtcclxuICAgIHRoaXMuX2NhcnQgPSBuZXcgQ2FydCh0aGlzLl9zdG9yYWdlLCB0aGlzLl9jYXJ0Q2hhbmdlZC5iaW5kKHRoaXMpKTtcclxuICAgIHRoaXMuX2NhcnRWaWV3ID0gbmV3IENhcnRWaWV3KHRoaXMuX2NhcnQpO1xyXG4gICAgdGhpcy5fc2hvcFZpZXcgPSBuZXcgU2hvcFZpZXcodGhpcy5fY2FydCk7XHJcbiAgICB0aGlzLl9wYXltZW50Rm9ybSA9IG5ldyBQYXltZW50Rm9ybSh0aGlzLl9jYXJ0KTtcclxuICAgIHRoaXMuX2NvbmZpcm1hdGlvblZpZXcgPSBuZXcgQ29uZmlybWF0aW9uVmlldygpO1xyXG4gICAgdGhpcy5faGVhZGVyID0gbmV3IEhlYWRlckNvbnRyb2xsZXIoKTtcclxuICAgIHRoaXMuX2hhc2hDaGFuZ2VMaXN0ZW5lciA9IHRoaXMuX2hhbmRsZUhhc2hDaGFuZ2UuYmluZCh0aGlzKTtcclxuICB9XHJcblxyXG4gIGluc3RhbGwoKSB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIHRoaXMuX2hhc2hDaGFuZ2VMaXN0ZW5lcik7XHJcbiAgICB0aGlzLl9zaG9wVmlldy5pbnN0YWxsKCk7XHJcbiAgICB0aGlzLl9jYXJ0Vmlldy5pbnN0YWxsKCk7XHJcbiAgfVxyXG5cclxuICB1bmluc3RhbGwoKSB7XHJcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIHRoaXMuX2hhc2hDaGFuZ2VMaXN0ZW5lcik7XHJcbiAgfVxyXG5cclxuICAvLyBNYW5hZ2UgZWxlbWVudCB2aXNpYmlsaXR5IChoaWRlIHRoZSBjYXJ0IHdoZW4gc3RvcmUgaXMgc2VsZWN0ZWQgYW5kIHZpY2UgdmVyc2EpXHJcbiAgc2V0IHNlbGVjdGlvbihzZWwpIHtcclxuICAgIHN3aXRjaChzZWwpIHtcclxuICAgICAgY2FzZSAnc2hvcCc6XHJcbiAgICAgIGNhc2UgJ2NhcnQnOlxyXG4gICAgICAgIHRoaXMuX2hlYWRlci5zZWxlY3Rpb24gPSBzZWw7XHJcbiAgICAgICAgdGhpcy5fc2hvcFZpZXcudmlzaWJsZSA9IHNlbCA9PT0gJ3Nob3AnO1xyXG4gICAgICAgIHRoaXMuX2NhcnRWaWV3LnZpc2libGUgPSBzZWwgIT09ICdzaG9wJztcclxuICAgICAgICB0aGlzLl9wYXltZW50Rm9ybS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fY29uZmlybWF0aW9uVmlldy52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlICdwYXknOlxyXG4gICAgICAgIHRoaXMuX2hlYWRlci5zZWxlY3Rpb24gPSAnY2FydCc7XHJcbiAgICAgICAgdGhpcy5fY2FydFZpZXcudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5fY29uZmlybWF0aW9uVmlldy52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fcGF5bWVudEZvcm0udmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBfcHJvbWlzZTtcclxuICAgICAgICBpZiAod2luZG93LlBheW1lbnRSZXF1ZXN0KSB7XHJcbiAgICAgICAgICBsZXQgYXBpID0gbmV3IFBheW1lbnRBUElXcmFwcGVyKCk7XHJcbiAgICAgICAgICBfcHJvbWlzZSA9IGFwaS5jaGVja291dCh0aGlzLl9jYXJ0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5fcGF5bWVudEZvcm0udmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICBfcHJvbWlzZSA9IHRoaXMuX3BheW1lbnRGb3JtLmNoZWNrb3V0KHRoaXMuX2NhcnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBfcHJvbWlzZVxyXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9jYXJ0LnJlc2V0KCk7XHJcbiAgICAgICAgICAgIHJlcGxhY2VMb2NhdGlvbkhhc2goJ3Nob3AnKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb24gPSAnc2hvcCc7XHJcbiAgICAgICAgICAgIGFsZXJ0KCdUaGFua3MgZm9yIHNob3BwaW5nISBQYXltZW50IHN1Y2Nlc3NmdWxseSBjb21wbGV0ZSA6KScpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGFsZXJ0KCdTb3JyeSwgcGF5bWVudCBmYWlsZWQgOignKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnY29uZmlybSc6XHJcbiAgICAgICAgdGhpcy5faGVhZGVyLnNlbGVjdGlvbiA9ICdjYXJ0JztcclxuICAgICAgICB0aGlzLl9jYXJ0Vmlldy52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fcGF5bWVudEZvcm0udmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX2NvbmZpcm1hdGlvblZpZXcudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBydW4oKSB7XHJcbiAgICByZXBsYWNlTG9jYXRpb25IYXNoKCdzaG9wJyk7XHJcbiAgICB0aGlzLl9jYXJ0LmxvYWQoKS50aGVuKCgpID0+IHtcclxuICAgICAgdGhpcy5fc2hvcFZpZXcucmVuZGVyKCk7XHJcbiAgICAgIHRoaXMuX2NhcnRWaWV3LnJlbmRlcigpO1xyXG4gICAgICB0aGlzLl91cGRhdGVDYXJ0Q291bnREaXNwbGF5KCk7XHJcbiAgICAgIHRoaXMuc2VsZWN0aW9uID0gJ3Nob3AnO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBIYW5kbGUgaGFzaENoYW5nZSwgbWFuYWdlIGhpc3RvcnkgKCNzdG9yZSBvciAjY2FydCwgbWF5YmUgI3BheSlcclxuICBfaGFuZGxlSGFzaENoYW5nZShldmVudCkge1xyXG4gICAgaWYgKCFldmVudC5uZXdVUkwpIHJldHVybjtcclxuICAgIGxldCBpbmRleCA9IGV2ZW50Lm5ld1VSTC5sYXN0SW5kZXhPZignIycpO1xyXG4gICAgaWYgKGluZGV4IDwgMCkgcmV0dXJuO1xyXG4gICAgbGV0IHNlbCA9IGV2ZW50Lm5ld1VSTC5zdWJzdHIoaW5kZXgrMSk7XHJcbiAgICB0aGlzLnNlbGVjdGlvbiA9IHNlbDtcclxuICB9XHJcblxyXG4gIF9jYXJ0Q2hhbmdlZChkZXRhaWxzKSB7XHJcbiAgICBpZiAoZGV0YWlscy5hY3Rpb24gPT09ICdsb2FkJykgcmV0dXJuO1xyXG4gICAgdGhpcy5fdXBkYXRlQ2FydENvdW50RGlzcGxheSgpO1xyXG4gICAgdGhpcy5fY2FydFZpZXcucmVuZGVyKCk7XHJcbiAgICB0aGlzLl9jYXJ0LnNhdmUoKTtcclxuICB9XHJcblxyXG4gIF91cGRhdGVDYXJ0Q291bnREaXNwbGF5KCkge1xyXG4gICAgdGhpcy5faGVhZGVyLmNvdW50ID0gdGhpcy5fY2FydC5jb3VudDtcclxuICB9XHJcbiAgLy8gVGVzdGluZyBob29rc1xyXG4gIHNldCBoZWFkZXJDb250cm9sbGVyKG9iaikge1xyXG4gICAgdGhpcy5faGVhZGVyID0gb2JqO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGNhcnQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY2FydDtcclxuICB9XHJcblxyXG4gIGdldCBzdG9yYWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3N0b3JhZ2U7XHJcbiAgfVxyXG5cclxuICBzZXQgc3RvcmFnZShhZGFwdG9yKSB7XHJcbiAgICB0aGlzLl9zdG9yYWdlID0gYWRhcHRvcjtcclxuICAgIHRoaXMuX2NhcnQuc3RvcmFnZSA9IGFkYXB0b3I7XHJcbiAgfVxyXG5cclxufVxyXG4iLCIvKlxyXG5Db3B5cmlnaHQgMjAxOCBHb29nbGUgSW5jLlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKi9cclxuXHJcbmltcG9ydCBWaWV3IGZyb20gJ3ZpZXcnO1xyXG5pbXBvcnQge3B1c2hMb2NhdGlvbkhhc2h9IGZyb20gJ3VybC10b29scyc7XHJcbmltcG9ydCB7ZmluZFByb2R1Y3R9IGZyb20gJ3Byb2R1Y3RzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcnRWaWV3IGV4dGVuZHMgVmlldyB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGNhcnQsIGNvbnRhaW5lcklkID0gJ2NhcnQnKSB7XHJcbiAgICBzdXBlcihjb250YWluZXJJZCk7XHJcbiAgICB0aGlzLl9jYXJ0ID0gY2FydDtcclxuICAgIHRoaXMuX2VsZW1lbnQgPSAndHInO1xyXG4gICAgdGhpcy5fZWxlbWVudENsYXNzID0gJ3Byb2R1Y3QnO1xyXG4gICAgdGhpcy5fY2xpY2tIYW5kbGVyID0gbnVsbDtcclxuICAgIHRoaXMuX3Rib2R5ID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5Jyk7XHJcbiAgICB0aGlzLl9jaGVja291dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVja291dEJ0bicpO1xyXG4gIH1cclxuXHJcbiAgaW5zdGFsbCgpIHtcclxuICAgIHRoaXMuX2NsaWNrSGFuZGxlciA9IHRoaXMuX2hhbmRsZUNsaWNrLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9jbGlja0hhbmRsZXIsIHRydWUpO1xyXG4gICAgLy8gQ2hlY2tvdXQgYnV0dG9uIHN3aXRjaGVzIGhhc2ggdG8gXCJwYXlcIiwgd2lsbCBjYXVzZSB0aGUgZm9ybSB0byBvcGVuXHJcbiAgICB0aGlzLl9jaGVja291dEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2dvVG9QYXltZW50LmJpbmQodGhpcykpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgLy8gUmVtb3ZlIGV4aXN0aW5nIHByb2R1Y3RzXHJcbiAgICBsZXQgaXRlbVJvd3MgPSB0aGlzLl90Ym9keS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuaXRlbVNlbGVjdG9yKTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbVJvd3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgdGhpcy5fdGJvZHkucmVtb3ZlQ2hpbGQoaXRlbVJvd3NbaV0pO1xyXG4gICAgfVxyXG4gICAgZm9yIChsZXQgaXRlbSBvZiB0aGlzLl9jYXJ0LmNhcnQpIHtcclxuICAgICAgbGV0IHByb2R1Y3QgPSBmaW5kUHJvZHVjdChpdGVtLnNrdSk7XHJcbiAgICAgIGxldCBwbGFjZWhvbGRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7XHJcbiAgICAgIHBsYWNlaG9sZGVyLmlubmVySFRNTCA9IGA8dHIgY2xhc3M9XCJwcm9kdWN0XCIgZGF0YS1za3U9XCIke3Byb2R1Y3Quc2t1fVwiPlxyXG4gICAgICAgIDx0ZCBjbGFzcz1cIm1kbC1kYXRhLXRhYmxlX19jZWxsLW5vbi1udW1lcmljXCI+JHtwcm9kdWN0LnRpdGxlfTwvdGQ+XHJcbiAgICAgICAgPHRkPiR7aXRlbS5xdWFudGl0eX08L3RkPlxyXG4gICAgICAgIDx0ZD4kJHtwcm9kdWN0LnByaWNlfTwvdGQ+XHJcbiAgICAgICAgPHRkPjxidXR0b24gY2xhc3M9XCJtZGwtYnV0dG9uIG1kbC1idXR0b24tLWNvbG9yZWQgbWRsLWpzLWJ1dHRvblxyXG4gICAgICAgICAgICAgIG1kbC1qcy1yaXBwbGUtZWZmZWN0IG1kbC1idXR0b24tLWFjY2VudCBkZWxldGVcIlxyXG4gICAgICAgICAgICAgIGRhdGEtc2t1PVwiJHtwcm9kdWN0LnNrdX1cIiBkYXRhLWFjdGlvbj1cInJlbW92ZVwiPlxyXG4gICAgICAgICAgICAgIDxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5kZWxldGU8L2k+cmVtb3ZlPC9idXR0b24+XHJcbiAgICAgICAgPC90ZD5cclxuICAgICAgPC90cj5gO1xyXG4gICAgICB0aGlzLl90Ym9keS5hcHBlbmRDaGlsZChwbGFjZWhvbGRlci5maXJzdEVsZW1lbnRDaGlsZCk7IC8vIFdBUk46IG5vIGllOFxyXG4gICAgfVxyXG4gICAgLy8gQWRkIHRoZSB0b3RhbCBwcmljZVxyXG4gICAgdGhpcy51cGRhdGVUb3RhbCgpO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlVG90YWwoKSB7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FydC10b3RhbCcpLmlubmVyVGV4dCA9IGAkJHt0aGlzLl9jYXJ0LnRvdGFsfWA7XHJcbiAgfVxyXG5cclxuICByZW1vdmVGcm9tVmlldyhza3UpIHtcclxuICAgIGxldCByb3cgPSB0aGlzLl90Ym9keS5xdWVyeVNlbGVjdG9yKGB0cltkYXRhLXNrdT0ke3NrdX1dYCk7XHJcbiAgICBpZiAocm93KSB7XHJcbiAgICAgIHJvdy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvdyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZVRvdGFsKCk7XHJcbiAgfVxyXG5cclxuICBfZ29Ub1BheW1lbnQoKSB7XHJcbiAgICBwdXNoTG9jYXRpb25IYXNoKCdwYXknKTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVDbGljayhldmVudCkge1xyXG4gICAgaWYgKGV2ZW50LnRhcmdldC5kYXRhc2V0KSB7XHJcbiAgICAgIGNvbnN0IHNrdSA9IGV2ZW50LnRhcmdldC5kYXRhc2V0LnNrdTtcclxuICAgICAgY29uc3QgYWN0aW9uID0gZXZlbnQudGFyZ2V0LmRhdGFzZXQuYWN0aW9uO1xyXG4gICAgICBpZiAoc2t1ICYmIGFjdGlvbiA9PSAncmVtb3ZlJykge1xyXG4gICAgICAgIGNvbnN0IHByb2R1Y3QgPSB0aGlzLl9jYXJ0LmZpbmRJdGVtKHNrdSk7XHJcbiAgICAgICAgdGhpcy5fY2FydC5yZW1vdmUocHJvZHVjdCk7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVGcm9tVmlldyhza3UpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyB1dGlsaXR5IGZvciB1bml0IHRlc3RpbmcgKHVzZWQgaW4gY291bnRpbmcgdGhlIG51bWJlciBvZiBlbGVtZW50cylcclxuICBnZXQgaXRlbVNlbGVjdG9yKCkge1xyXG4gICAgcmV0dXJuIGAke3RoaXMuX2VsZW1lbnR9LiR7dGhpcy5fZWxlbWVudENsYXNzfVtkYXRhLXNrdV1gO1xyXG4gIH1cclxuXHJcbiAgc2V0IGNhcnQoY2FydCkge1xyXG4gICAgdGhpcy5fY2FydCA9IGNhcnQ7XHJcbiAgfVxyXG5cclxufVxyXG4iLCIvKlxyXG5Db3B5cmlnaHQgMjAxOCBHb29nbGUgSW5jLlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKi9cclxuXHJcbi8vanNoaW50IGVzdmVyc2lvbjogNlxyXG5cclxuaW1wb3J0IHsgZmluZFByb2R1Y3QgfSBmcm9tICdwcm9kdWN0cyc7XHJcblxyXG5leHBvcnQgY29uc3QgQ0FSVF9FVkVOVCA9IFwiY2FydGNoYW5nZVwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FydCB7XHJcbiAgY29uc3RydWN0b3IgKGFkYXB0b3IsIGNoYW5nZUNhbGxiYWNrKSB7XHJcbiAgICB0aGlzLml0ZW1zID0gW107XHJcbiAgICB0aGlzLl9zdG9yYWdlID0gYWRhcHRvcjtcclxuICAgIHRoaXMuX2xvYWRpbmcgPSBmYWxzZTtcclxuICAgIHRoaXMuX2NhbGxiYWNrID0gY2hhbmdlQ2FsbGJhY2s7IC8vIHVzZWQgdG8gcmVwb3J0IGNoYW5nZXMgYmFjayB0byB0aGUgYXBwXHJcbiAgfVxyXG5cclxuICBmaW5kSXRlbShza3UpIHtcclxuICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbmQoaXRlbSA9PiBpdGVtLnNrdSA9PT0gc2t1KTtcclxuICB9XHJcblxyXG4gIGFkZChwcm9kdWN0LCBxdWFudGl0eT0xKSB7XHJcbiAgICBpZiAocXVhbnRpdHkgPCAwIHx8ICFwcm9kdWN0KSByZXR1cm4gbnVsbDtcclxuICAgIGxldCBpdGVtID0gdGhpcy5maW5kSXRlbShwcm9kdWN0LnNrdSk7XHJcbiAgICBpZiAoaXRlbSkge1xyXG4gICAgICBpdGVtLnF1YW50aXR5ICs9IHF1YW50aXR5O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaXRlbSA9IG5ldyBMaW5lSXRlbShwcm9kdWN0LCBxdWFudGl0eSk7XHJcbiAgICAgIHRoaXMuaXRlbXMucHVzaChpdGVtKTtcclxuICAgIH1cclxuICAgIHRoaXMuX3JlcG9ydENoYW5nZSgnYWRkJywgcHJvZHVjdCwgcXVhbnRpdHkpO1xyXG4gICAgcmV0dXJuIGl0ZW07XHJcbiAgfVxyXG5cclxuICByZW1vdmUocHJvZHVjdCkge1xyXG4gICAgbGV0IGluZGV4ID0gdGhpcy5pdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLnNrdSA9PT0gcHJvZHVjdC5za3UpO1xyXG4gICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fcmVwb3J0Q2hhbmdlKCdyZW1vdmUnLCBwcm9kdWN0KTtcclxuICB9XHJcblxyXG4gIGNoYW5nZShwcm9kdWN0LCBxdWFudGl0eSkge1xyXG4gICAgbGV0IGl0ZW0gPSB0aGlzLmZpbmRJdGVtKHByb2R1Y3Quc2t1KTtcclxuICAgIGlmIChxdWFudGl0eSA8PSAwKSB7XHJcbiAgICAgIHRoaXMucmVtb3ZlKGl0ZW0pO1xyXG4gICAgICB0aGlzLl9yZXBvcnRDaGFuZ2UoJ3JlbW92ZScsIHByb2R1Y3QpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGl0ZW0ucXVhbnRpdHkgPSBxdWFudGl0eTtcclxuICAgICAgdGhpcy5fcmVwb3J0Q2hhbmdlKCdjaGFuZ2UnLCBwcm9kdWN0LCBxdWFudGl0eSk7XHJcbiAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLml0ZW1zID0gW107XHJcbiAgICB0aGlzLl9yZXBvcnRDaGFuZ2UoJ3Jlc2V0Jyk7XHJcbiAgfVxyXG5cclxuICBnZXQgbGVuZ3RoKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXMubGVuZ3RoO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGNvdW50KCkge1xyXG4gICAgbGV0IGNvdW50ID0gMDtcclxuICAgIGZvciAobGV0IGl0ZW0gb2YgdGhpcy5pdGVtcykge1xyXG4gICAgICBjb3VudCArPSBpdGVtLnF1YW50aXR5O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvdW50O1xyXG4gIH1cclxuXHJcbiAgZ2V0IHRvdGFsKCkge1xyXG4gICAgbGV0IHRvdGFsID0gMDtcclxuICAgIGZvciAobGV0IGl0ZW0gb2YgdGhpcy5pdGVtcykge1xyXG4gICAgICB0b3RhbCArPSBpdGVtLnRvdGFsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRvdGFsO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGNhcnQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pdGVtcztcclxuICB9XHJcblxyXG4gIHNhdmUoKSB7XHJcbiAgICBpZiAoIXRoaXMuX3N0b3JhZ2UpIHJldHVybjtcclxuICAgIHJldHVybiB0aGlzLl9zdG9yYWdlLnNhdmUodGhpcy5pdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0uc2F2ZWRWYWx1ZSkpO1xyXG4gIH1cclxuXHJcbiAgbG9hZCgpIHtcclxuICAgIGlmICghdGhpcy5fc3RvcmFnZSkgcmV0dXJuO1xyXG4gICAgdGhpcy5fbG9hZGluZyA9IHRydWU7XHJcbiAgICByZXR1cm4gdGhpcy5fc3RvcmFnZS5sb2FkKCkudGhlbihsb2FkZWRJdGVtcyA9PiB7XHJcbiAgICAgIHRoaXMuaXRlbXMgPSBsb2FkZWRJdGVtcy5tYXAoKHMpID0+IHsgbGV0IGxpID0gbmV3IExpbmVJdGVtKCk7IGxpLnNhdmVkVmFsdWUgPSBzOyByZXR1cm4gbGl9KTtcclxuICAgIH0pLmNhdGNoKGUgPT4ge1xyXG4gICAgICB0aGlzLml0ZW1zID0gW107XHJcbiAgICB9KS50aGVuKCgpID0+IHtcclxuICAgICAgdGhpcy5fbG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICB0aGlzLl9yZXBvcnRDaGFuZ2UoJ2xvYWQnKTtcclxuICAgICAgcmV0dXJuIHRoaXMuaXRlbXM7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9yZXBvcnRDaGFuZ2UoYWN0aW9uLCBwcm9kdWN0LCBxdWFudGl0eSkge1xyXG4gICAgaWYgKHRoaXMuX2xvYWRpbmcpIHJldHVybjsgLy8gZG9uJ3Qgc3BhbSB0aGUgYXBwIHdpdGggZXZlbnRzXHJcbiAgICBsZXQgZGV0YWlscyA9IHsnYWN0aW9uJzogKGFjdGlvbiksICd0b3RhbCc6ICh0aGlzLnRvdGFsKX07XHJcbiAgICBpZiAocHJvZHVjdCkgZGV0YWlscy5za3UgPSBwcm9kdWN0LnNrdTtcclxuICAgIGlmIChxdWFudGl0eSkgZGV0YWlscy5xdWFudGl0eSA9IHF1YW50aXR5O1xyXG4gICAgaWYgKHRoaXMuX2NhbGxiYWNrKSB0aGlzLl9jYWxsYmFjayhkZXRhaWxzKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBMaW5lSXRlbSB7XHJcbiAgY29uc3RydWN0b3IocHJvZHVjdCwgcXVhbnRpdHkpIHtcclxuICAgIGlmIChwcm9kdWN0ID09IG51bGwpIHtcclxuICAgICAgdGhpcy5fc2t1ID0gbnVsbDtcclxuICAgICAgdGhpcy5fcHJpY2UgPSB0aGlzLl9xdWFudGl0eSA9IDA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9za3UgPSBwcm9kdWN0LnNrdTtcclxuICAgICAgdGhpcy5fcHJpY2UgPSBwcm9kdWN0LnByaWNlO1xyXG4gICAgICB0aGlzLl9xdWFudGl0eSA9IHF1YW50aXR5O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0IHNrdSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9za3U7XHJcbiAgfVxyXG5cclxuICBnZXQgcHJpY2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcHJpY2U7XHJcbiAgfVxyXG5cclxuICBnZXQgdG90YWwoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcXVhbnRpdHkgKiB0aGlzLl9wcmljZTtcclxuICB9XHJcblxyXG4gIGdldCBxdWFudGl0eSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9xdWFudGl0eTtcclxuICB9XHJcblxyXG4gIHNldCBxdWFudGl0eSh2YWx1ZSkge1xyXG4gICAgdGhpcy5fcXVhbnRpdHkgPSB2YWx1ZSA8IDAgPyAwIDogdmFsdWU7XHJcbiAgfVxyXG5cclxuICAvLyBPbmx5IHNhdmUgbWluaW1hbCBpbmZvcm1hdGlvbiAodG8gY29uc2VydmUgc3BhY2UgJiBwcmV2ZW50IHNwb29maW5nKVxyXG4gIGdldCBzYXZlZFZhbHVlKCkge1xyXG4gICAgcmV0dXJuIHtza3U6ICh0aGlzLl9za3UpLCBxdHk6ICh0aGlzLl9xdWFudGl0eSl9O1xyXG4gIH1cclxuXHJcbiAgc2V0IHNhdmVkVmFsdWUodmFsdWUpIHtcclxuICAgIGxldCBwcm9kdWN0ID0gZmluZFByb2R1Y3QodmFsdWUuc2t1KTtcclxuICAgIGlmICghcHJvZHVjdCkgdGhyb3cgbmV3IEVycm9yKGBTS1Ugbm90IGZvdW5kOiAke3ZhbHVlLnNrdX1gKTtcclxuICAgIHRoaXMuX3NrdSA9IHZhbHVlLnNrdTtcclxuICAgIHRoaXMuX3F1YW50aXR5ID0gdmFsdWUucXR5O1xyXG4gICAgdGhpcy5fcHJpY2UgPSBwcm9kdWN0LnByaWNlO1xyXG4gIH1cclxuXHJcbiAgc2V0IHN0b3JhZ2UoYWRhcHRvcikge1xyXG4gICAgdGhpcy5fc3RvcmFnZSA9IGFkYXB0b3I7XHJcbiAgfVxyXG5cclxufVxyXG4iLCIvKlxyXG5Db3B5cmlnaHQgMjAxOCBHb29nbGUgSW5jLlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKi9cclxuXHJcbmltcG9ydCBWaWV3IGZyb20gJ3ZpZXcnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uZmlybWF0aW9uVmlldyBleHRlbmRzIFZpZXcge1xyXG5cclxuICBjb25zdHJ1Y3Rvcihjb250YWluZXJJZCA9ICdjb25maXJtYXRpb24nKSB7XHJcbiAgICBzdXBlcihjb250YWluZXJJZCk7XHJcbiAgICB0aGlzLl9yZXF1ZXN0RGF0YSA9ICcnO1xyXG4gICAgdGhpcy5fcmVzcG9uc2VEYXRhID0gJyc7XHJcbiAgICB0aGlzLl9yZXF1ZXN0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcXVlc3REYXRhJyk7XHJcbiAgICB0aGlzLl9yZXNwb25zZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNwb25zZURhdGEnKTtcclxuICAgIC8vIHRoaXMuX2NsaWNrSGFuZGxlciA9IG51bGw7XHJcbiAgICAvLyB0aGlzLl9jaGVja291dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVja291dEJ0bicpO1xyXG4gIH1cclxuXHJcbiAgaW5zdGFsbCgpIHtcclxuICAgIC8vIHRoaXMuX2NsaWNrSGFuZGxlciA9IHRoaXMuX2hhbmRsZUNsaWNrLmJpbmQodGhpcyk7XHJcbiAgICAvLyB0aGlzLl9jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9jbGlja0hhbmRsZXIsIHRydWUpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgdGhpcy5fcmVxdWVzdERpdi5pbm5lclRleHQgPSB0aGlzLl9yZXF1ZXN0RGF0YTtcclxuICAgIHRoaXMuX3Jlc3BvbnNlRGl2LmlubmVyVGV4dCA9IHRoaXMuX3Jlc3BvbnNlRGF0YTtcclxuICB9XHJcblxyXG4gIHNldCByZXF1ZXN0RGF0YSh2YWx1ZSkge1xyXG4gICAgdGhpcy5fcmVxdWVzdERhdGEgPSAodmFsdWUgPT09IG51bGwgPyAnJyA6IHZhbHVlKTtcclxuICAgIHRoaXMuX3JlbmRlcigpO1xyXG4gIH1cclxuXHJcbiAgc2V0IHJlc3BvbnNlRGF0YSh2YWx1ZSkge1xyXG4gICAgdGhpcy5fcmVzcG9uc2VEYXRhID0gKHZhbHVlID09PSBudWxsID8gJycgOiB2YWx1ZSk7XHJcbiAgICB0aGlzLl9yZW5kZXIoKTtcclxuICB9XHJcblxyXG59XHJcbiIsIi8qXHJcbkNvcHlyaWdodCAyMDE4IEdvb2dsZSBJbmMuXHJcblxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG5cclxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qL1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGhhc1ByZXJlcXVpc2l0ZXMoKSB7XHJcbiAgY29uc3QgaGFzU3RvcmFnZSA9IGhhc0xvY2FsU3RvcmFnZSgpIHx8IGhhc0luZGV4ZWREQigpO1xyXG4gIC8vIGZpcnN0RWxlbWVudENoaWxkIG5vdCBpbiBpZThcclxuICBjb25zdCBoYXNGaXJzdEVsZW1lbnRDaGlsZCA9ICgnZmlyc3RFbGVtZW50Q2hpbGQnIGluIGRvY3VtZW50KTtcclxuICByZXR1cm4gaGFzU3RvcmFnZSAmIGhhc0ZpcnN0RWxlbWVudENoaWxkO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFzTG9jYWxTdG9yYWdlKCkge1xyXG4gIHJldHVybiAoJ0xvY2FsU3RvcmFnZScgaW4gd2luZG93KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGhhc0luZGV4ZWREQigpIHtcclxuICByZXR1cm4gKCdpbmRleGVkREInIGluIHdpbmRvdyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBoYXNQYXltZW50UmVxdWVzdCgpIHtcclxuICByZXR1cm4gKCdQYXltZW50UmVxdWVzdCcgaW4gd2luZG93KTtcclxufVxyXG4iLCIvKlxyXG5Db3B5cmlnaHQgMjAxOCBHb29nbGUgSW5jLlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKi9cclxuXHJcbi8vanNoaW50IGVzdmVyc2lvbjogNlxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIZWFkZXJDb250cm9sbGVyIHtcclxuXHJcbiAgY29uc3RydWN0b3IgKGNvbnRhaW5lcklkPSdoZWFkZXJzJykge1xyXG4gICAgdGhpcy5fY29udGFpbmVySWQgPSBjb250YWluZXJJZDtcclxuICAgIHRoaXMuX3NlbGVjdGlvbiA9ICdzaG9wJztcclxuICAgIHRoaXMuX2NvdW50ID0gMDtcclxuICB9XHJcblxyXG4gIGdldCBzZWxlY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbjtcclxuICB9XHJcblxyXG4gIHNldCBzZWxlY3Rpb24obmV3VmFsdWUpIHtcclxuICAgIGlmIChuZXdWYWx1ZSAhPSAnc2hvcCcgJiYgbmV3VmFsdWUgIT0gJ2NhcnQnKSByZXR1cm47XHJcbiAgICBpZiAobmV3VmFsdWUgPT0gdGhpcy5fc2VsZWN0aW9uKSByZXR1cm47XHJcbiAgICB0aGlzLl9zZWxlY3Rpb24gPSBuZXdWYWx1ZTtcclxuXHJcbiAgICAvLyBOb3cgdXBkYXRlIHRoZSBVSVxyXG4gICAgbGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuX2NvbnRhaW5lcklkKTtcclxuICAgIC8vIE9ubHkgdHdvIGtpbmRzIG9mIGxpbmtzLCBzbyBmbGlwIGFjdGl2ZVxyXG4gICAgbGV0IGxpbmtzID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EubWRsLW5hdmlnYXRpb25fX2xpbmsnKTtcclxuICAgIGZvciAobGV0IGk9MDsgaSA8IGxpbmtzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGxpbmtzW2ldLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0IGNvdW50KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2NvdW50O1xyXG4gIH1cclxuXHJcbiAgc2V0IGNvdW50KG5ld0NvdW50KSB7XHJcbiAgICBpZiAodGhpcy5fY291bnQgPT0gbmV3Q291bnQpIHJldHVybjtcclxuICAgIC8vIFRPRE8gdXNlIGEgYmFkZ2UgaW5zdGVhZFxyXG4gICAgY29uc3QgbGFiZWwgPSBuZXdDb3VudCA9PT0gMCA/ICcnIDogYCAoJHtuZXdDb3VudH0gaXRlbXMpYDtcclxuICAgIHRoaXMuX2NvdW50ID0gbmV3Q291bnQ7XHJcbiAgICBsZXQgc3BhbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAjJHt0aGlzLl9jb250YWluZXJJZH0gYVtocmVmPVwiI2NhcnRcIl1gKTtcclxuICAgIGZvciAobGV0IGk9MDsgaSA8IHNwYW5zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIHNwYW5zW2ldLmlubmVyVGV4dCA9IGBDYXJ0JHtsYWJlbH1gO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuIiwiLypcclxuQ29weXJpZ2h0IDIwMTggR29vZ2xlIEluYy5cclxuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcblxyXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiovXHJcblxyXG5pbXBvcnQgKiBhcyBpZGIgZnJvbSAnaWRiJztcclxuXHJcbmNvbnN0IENBUlRfU1RPUkUgPSAnY2FydCc7XHJcbmNvbnN0IFJXID0gJ3JlYWR3cml0ZSc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJREJTdG9yYWdlIHtcclxuXHJcbiAgY29uc3RydWN0b3IoaWQgPSAnbWZzLWNhcnQtaXRlbXMnKSB7XHJcbiAgICB0aGlzLl9pZCA9IGlkO1xyXG4gICAgdGhpcy5fb3BlbigpO1xyXG4gIH1cclxuXHJcbiAgLyogVGFrZXMgYW4gYXJyYXkgb2YgaXRlbXMgYW5kIHdyaXRlcyBKU09OIHRvIGxvY2FsIHN0b3JhZ2UgKi9cclxuICBzYXZlKGl0ZW1zKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xyXG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKENBUlRfU1RPUkUsIFJXKTtcclxuICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShDQVJUX1NUT1JFKTtcclxuICAgICAgcmV0dXJuIHN0b3JlLmNsZWFyKCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYWRkQWxsID0gaXRlbXMubWFwKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gc3RvcmUuYWRkKHtza3U6IChpdGVtLnNrdSksIHF0eTogKGl0ZW0ucXR5KX0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChhZGRBbGwpO1xyXG4gICAgICB9KS50aGVuKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2RiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKENBUlRfU1RPUkUsIFJXKVxyXG4gICAgICAgIC5vYmplY3RTdG9yZShDQVJUX1NUT1JFKVxyXG4gICAgICAgIC5nZXRBbGwoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlKCkge1xyXG4vLyAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLl9pZCk7XHJcbiAgfVxyXG5cclxuICAvLyBSZXR1cm5zIGEgcHJvbWlzZSB3aXRoIHRoZSB0b3RhbCBudW1iZXIgb2YgcmVjb3JkcyBzYXZlZFxyXG4gIGNvdW50KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2RiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihDQVJUX1NUT1JFKTtcclxuICAgICAgcmV0dXJuIHR4Lm9iamVjdFN0b3JlKENBUlRfU1RPUkUpLmNvdW50KCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFRlc3RpbmcgdXNlIG9ubHksIHdpbGwgY2xvc2UgdGhlIGRhYmFzZSBidXQgcmVuZGVycyB0aGUgYWRhcHRvciB1bnVzYWJsZVxyXG4gIF9jbG9zZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9kYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgIGxldCBjbG9zZVByb21pc2UgPSBkYi5jbG9zZSgpO1xyXG4gICAgICB0aGlzLl9kYlByb21pc2UgPSBudWxsO1xyXG4gICAgICByZXR1cm4gY2xvc2VQcm9taXNlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfb3BlbigpIHtcclxuICAgIHJldHVybiB0aGlzLl9kYlByb21pc2UgPSBpZGIub3Blbih0aGlzLl9pZCwgMSwgdXBncmFkZURCID0+IHtcclxuICAgICAgdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKENBUlRfU1RPUkUsIHthdXRvSW5jcmVtZW50OiB0cnVlfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIHRlc3RpbmcgaG9va3Mgc28gd2UgY2FuIHRlc3Qgdy9vIHdyZWNraW5nIHRoZSBzdG9yZWQgZGF0YVxyXG4gIHNldCBrZXkodmFsdWUpIHtcclxuICAgIGlmICh2YWx1ZSA9PT0gdGhpcy5faWQpIHJldHVybjtcclxuICAgIHRoaXMuX2Nsb3NlKCkudGhlbigoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2lkID0gdmFsdWU7XHJcbiAgICAgIHRoaXMuX29wZW4oKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGtleSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9pZDtcclxuICB9XHJcblxyXG4gIGdldCBzdG9yYWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2RiUHJvbWlzZTtcclxuICB9XHJcbn1cclxuIiwiLypcclxuQ29weXJpZ2h0IDIwMTggR29vZ2xlIEluYy5cclxuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcblxyXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiovXHJcblxyXG4vKlxyXG4gKiBTaW1wbGUgc2VydmVyIGZldGNoIGZ1bmN0aW9uIHRoYXQgb25seSBzZW5kIGEgcmVxdWVzdCB0byAvY2hlY2tvdXRcclxuICogYW5kIHJldHVybnMgYHRydWVgIG9yIHRocm93cyBhbiBleGNlcHRpb24uXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzZW5kVG9TZXJ2ZXIoZGF0YSkge1xyXG4gIHJldHVybiBmZXRjaCgnL2NoZWNrb3V0LycsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJyxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpXHJcbiAgfSkudGhlbihyZXMgPT4ge1xyXG4gICAgaWYgKHJlcy5zdGF0dXMgIT09IDIwMCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFBheW1lbnQgZmFpbHVyZSAoaWQgJHtyZXMuc3RhdHVzfSlgKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH0pO1xyXG59XHJcbiIsIi8qXHJcbkNvcHlyaWdodCAyMDE4IEdvb2dsZSBJbmMuXHJcblxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG5cclxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qL1xyXG5cclxuaW1wb3J0IHNlbmRUb1NlcnZlciBmcm9tICdtZXJjaGFudC1zZXJ2ZXInO1xyXG5cclxuY29uc3QgU0hJUFBJTkdfT1BUSU9OUyA9IHtcclxuICB1czogW1xyXG4gICAge1xyXG4gICAgICBpZDogJ3N0YW5kYXJkJyxcclxuICAgICAgbGFiZWw6ICdTdGFuZGFyZCBTaGlwcGluZycsXHJcbiAgICAgIHByaWNlOiAwXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBpZDogJ2V4cHJlc3MnLFxyXG4gICAgICBsYWJlbDogJ0V4cHJlc3MgU2hpcHBpbmcnLFxyXG4gICAgICBwcmljZTogMTBcclxuICAgIH1cclxuICBdLFxyXG4gIGludGVybmF0aW9uYWw6IFtcclxuICAgIHtcclxuICAgICAgaWQ6ICdpbnRlcm5hdGlvbmFsJyxcclxuICAgICAgbGFiZWw6ICdJbnRlcm5hdGlvbmFsIFNoaXBwaW5nJyxcclxuICAgICAgcHJpY2U6IDE1XHJcbiAgICB9XHJcbiAgXVxyXG59O1xyXG5cclxuY29uc3QgUEFZTUVOVF9NRVRIT0RTID0gW1xyXG5dO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGF5bWVudEFQSVdyYXBwZXIge1xyXG5cclxuICAvKlxyXG4gICogR2l2ZW4gYSBjYXJ0IHNldCB1cCB3aXRoIGFuIG9yZGVyLCBnZXRzIHBheW1lbnQgYXV0aG9yaXphdGlvbi5cclxuICAqIFJldHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiBwYXltZW50IGlzIGNvbXBsZXRlLCB0aGlzXHJcbiAgKiBoYXMgYSBkYXRhIG9iamVjdCB5b3UgY2FuIHBhc3MgdG8gdGhlIGJhY2stZW5kIHBheW1lbnQgc2VydmVyLlxyXG4gICovXHJcbiAgY2hlY2tvdXQoY2FydCkge1xyXG4gICAgbGV0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkUGF5bWVudFJlcXVlc3QoY2FydCk7XHJcbiAgICBsZXQgcmVzcG9uc2U7XHJcbiAgICAvLyBTaG93IFVJIHRoZW4gY29udGludWUgd2l0aCB1c2VyIHBheW1lbnQgaW5mb1xyXG4gICAgcmV0dXJuIHJlcXVlc3Quc2hvdygpXHJcbiAgICAgIC50aGVuKHIgPT4ge1xyXG4gICAgICAgIC8vIFRoZSBVSSB3aWxsIHNob3cgYSBzcGlubmVyIHRvIHRoZSB1c2VyIHVudGlsXHJcbiAgICAgICAgLy8gYHJlcXVlc3QuY29tcGxldGUoKWAgaXMgY2FsbGVkLlxyXG4gICAgICAgIHJlc3BvbnNlID0gcjtcclxuICAgICAgICBsZXQgZGF0YSA9IHIudG9KU09OKCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgIHJldHVybiBzZW5kVG9TZXJ2ZXIoZGF0YSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICByZXNwb25zZS5jb21wbGV0ZSgnc3VjY2VzcycpO1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGUgPT4ge1xyXG4gICAgICAgIGlmIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgICAgICAgIHJlc3BvbnNlLmNvbXBsZXRlKCdmYWlsJyk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLmNvZGUgIT09IGUuQUJPUlRfRVJSKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgICAgdGhyb3cgZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICogQ3JlYXRlcyBhIFBheW1lbnRSZXF1ZXN0IG9iamVjdCBpbmNsdWRpbmcgdGhlIGV2ZW50IGhhbmRsZXJzIHVzZWQgdG9cclxuICAgKiB1cGRhdGUgdGhlIHBheW1lbnQgZGV0YWlscyBhcyB0aGUgdXNlciBtYWtlcyBjaG9pY2VzLlxyXG4gICAqL1xyXG4gIGJ1aWxkUGF5bWVudFJlcXVlc3QoY2FydCkge1xyXG4gICAgLy8gU3VwcG9ydGVkIHBheW1lbnQgaW5zdHJ1bWVudHNcclxuICAgIGNvbnN0IHN1cHBvcnRlZEluc3RydW1lbnRzID0gW3tcclxuICAgICAgc3VwcG9ydGVkTWV0aG9kczogWydiYXNpYy1jYXJkJ10sXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBzdXBwb3J0ZWROZXR3b3JrczogWyd2aXNhJywgJ21hc3RlcmNhcmQnLCAnYW1leCcsXHJcbiAgICAgICAgICAnamNiJywgJ2RpbmVycycsICdkaXNjb3ZlcicsICdtaXInLCAndW5pb25wYXknXVxyXG4gICAgICB9XHJcbiAgICB9XTtcclxuXHJcbiAgICAvLyBQYXltZW50IG9wdGlvbnNcclxuICAgIGNvbnN0IHBheW1lbnRPcHRpb25zID0ge1xyXG4gICAgICByZXF1ZXN0U2hpcHBpbmc6IHRydWUsXHJcbiAgICAgIHJlcXVlc3RQYXllckVtYWlsOiB0cnVlLFxyXG4gICAgICByZXF1ZXN0UGF5ZXJQaG9uZTogdHJ1ZSxcclxuICAgICAgcmVxdWVzdFBheWVyTmFtZTogdHJ1ZVxyXG4gICAgfTtcclxuXHJcbiAgICBsZXQgc2hpcHBpbmdPcHRpb25zID0gW107XHJcbiAgICBsZXQgc2VsZWN0ZWRPcHRpb24gPSBudWxsO1xyXG5cclxuICAgIGxldCBkZXRhaWxzID0gdGhpcy5idWlsZFBheW1lbnREZXRhaWxzKGNhcnQsIHNoaXBwaW5nT3B0aW9ucywgc2VsZWN0ZWRPcHRpb24pO1xyXG5cclxuICAgIC8vIEluaXRpYWxpemVcclxuICAgIGxldCByZXF1ZXN0ID0gbmV3IFBheW1lbnRSZXF1ZXN0KHN1cHBvcnRlZEluc3RydW1lbnRzLCBkZXRhaWxzLCBwYXltZW50T3B0aW9ucyk7XHJcblxyXG4gICAgLy8gV2hlbiB1c2VyIHNlbGVjdHMgYSBzaGlwcGluZyBhZGRyZXNzLCBhZGQgc2hpcHBpbmcgb3B0aW9ucyB0byBtYXRjaFxyXG4gICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzaGlwcGluZ2FkZHJlc3NjaGFuZ2UnLCBlID0+IHtcclxuICAgICAgZS51cGRhdGVXaXRoKChfID0+IHtcclxuICAgICAgICAvLyBHZXQgdGhlIHNoaXBwaW5nIG9wdGlvbnMgYW5kIHNlbGVjdCB0aGUgbGVhc3QgZXhwZW5zaXZlXHJcbiAgICAgICAgc2hpcHBpbmdPcHRpb25zID0gdGhpcy5vcHRpb25zRm9yQ291bnRyeShyZXF1ZXN0LnNoaXBwaW5nQWRkcmVzcy5jb3VudHJ5KTtcclxuICAgICAgICBzZWxlY3RlZE9wdGlvbiA9IHNoaXBwaW5nT3B0aW9uc1swXS5pZDtcclxuICAgICAgICBsZXQgZGV0YWlscyA9IHRoaXMuYnVpbGRQYXltZW50RGV0YWlscyhjYXJ0LCBzaGlwcGluZ09wdGlvbnMsIHNlbGVjdGVkT3B0aW9uKTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGRldGFpbHMpO1xyXG4gICAgICB9KSgpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFdoZW4gdXNlciBzZWxlY3RzIGEgc2hpcHBpbmcgb3B0aW9uLCB1cGRhdGUgY29zdCwgZXRjLiB0byBtYXRjaFxyXG4gICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzaGlwcGluZ29wdGlvbmNoYW5nZScsIGUgPT4ge1xyXG4gICAgICBlLnVwZGF0ZVdpdGgoKF8gPT4ge1xyXG4gICAgICAgIHNlbGVjdGVkT3B0aW9uID0gcmVxdWVzdC5zaGlwcGluZ09wdGlvbjtcclxuICAgICAgICBsZXQgZGV0YWlscyA9IHRoaXMuYnVpbGRQYXltZW50RGV0YWlscyhjYXJ0LCBzaGlwcGluZ09wdGlvbnMsIHNlbGVjdGVkT3B0aW9uKTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGRldGFpbHMpO1xyXG4gICAgICB9KSgpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiByZXF1ZXN0O1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiBDcmVhdGVzIHRoZSBQYXltZW50RGV0YWlscyBkaWN0aW9uYXJ5IGluc2lkZSB0aGUgUGF5bWVudFJlcXVlc3QuXHJcbiAgICogVGhpcyBjYW4gY2hhbmdlIGFzIHRoZSB1c2VyIHNlbGVjdHMgc2hpcHBpbmcgb3B0aW9ucy5cclxuICAgKi9cclxuICBidWlsZFBheW1lbnREZXRhaWxzKGNhcnQsIHNoaXBwaW5nT3B0aW9ucywgc2hpcHBpbmdPcHRpb25JZCkge1xyXG4gICAgLy8gU3RhcnQgd2l0aCB0aGUgY2FydCBpdGVtc1xyXG4gICAgbGV0IGRpc3BsYXlJdGVtcyA9IGNhcnQuY2FydC5tYXAoaXRlbSA9PiB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbGFiZWw6IGAke2l0ZW0uc2t1fTogJHtpdGVtLnF1YW50aXR5fXggJCR7aXRlbS5wcmljZX1gLFxyXG4gICAgICAgIGFtb3VudDoge2N1cnJlbmN5OiAnVVNEJywgdmFsdWU6IFN0cmluZyhpdGVtLnRvdGFsKX1cclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gICAgbGV0IHRvdGFsID0gY2FydC50b3RhbDtcclxuXHJcbiAgICBsZXQgZGlzcGxheWVkU2hpcHBpbmdPcHRpb25zID0gW107XHJcbiAgICBpZiAoc2hpcHBpbmdPcHRpb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgbGV0IHNlbGVjdGVkT3B0aW9uID0gc2hpcHBpbmdPcHRpb25zLmZpbmQob3B0aW9uID0+IHtcclxuICAgICAgICByZXR1cm4gb3B0aW9uLmlkID09PSBzaGlwcGluZ09wdGlvbklkO1xyXG4gICAgICB9KTtcclxuICAgICAgZGlzcGxheWVkU2hpcHBpbmdPcHRpb25zID0gc2hpcHBpbmdPcHRpb25zLm1hcChvcHRpb24gPT4ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBpZDogb3B0aW9uLmlkLFxyXG4gICAgICAgICAgbGFiZWw6IG9wdGlvbi5sYWJlbCxcclxuICAgICAgICAgIGFtb3VudDoge2N1cnJlbmN5OiAnVVNEJywgdmFsdWU6IFN0cmluZyhvcHRpb24ucHJpY2UpfSxcclxuICAgICAgICAgIHNlbGVjdGVkOiBvcHRpb24uaWQgPT09IHNoaXBwaW5nT3B0aW9uSWRcclxuICAgICAgICB9O1xyXG4gICAgICB9KTtcclxuICAgICAgaWYgKHNlbGVjdGVkT3B0aW9uKSB0b3RhbCArPSBzZWxlY3RlZE9wdGlvbi5wcmljZTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZGV0YWlscyA9IHtcclxuICAgICAgZGlzcGxheUl0ZW1zOiBkaXNwbGF5SXRlbXMsXHJcbiAgICAgIHRvdGFsOiB7XHJcbiAgICAgICAgbGFiZWw6ICdUb3RhbCBkdWUnLFxyXG4gICAgICAgIGFtb3VudDoge2N1cnJlbmN5OiAnVVNEJywgdmFsdWU6IFN0cmluZyh0b3RhbCl9XHJcbiAgICAgIH0sXHJcbiAgICAgIHNoaXBwaW5nT3B0aW9uczogZGlzcGxheWVkU2hpcHBpbmdPcHRpb25zXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBkZXRhaWxzO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGV4dHJhY3QgdGhlIGNvcnJlY3Qgc2hpcHBpbmcgb3B0aW9ucyBmb3IgYSBjb3VudHJ5LlxyXG4gICAqL1xyXG4gIG9wdGlvbnNGb3JDb3VudHJ5KGNvdW50cnkpIHtcclxuICAgIGNvdW50cnkgPSBjb3VudHJ5LnRvTG93ZXJDYXNlKCk7XHJcbiAgICBpZiAoIWNvdW50cnkgfHwgIVNISVBQSU5HX09QVElPTlMuaGFzT3duUHJvcGVydHkoY291bnRyeSkpIHtcclxuICAgICAgY291bnRyeSA9ICdpbnRlcm5hdGlvbmFsJztcclxuICAgIH1cclxuICAgIGxldCBvcHRpb25zID0gU0hJUFBJTkdfT1BUSU9OU1tjb3VudHJ5XTtcclxuICAgIC8vIFNvcnQgYnkgcHJpY2UsIGxvd2VzdCBmaXJzdFxyXG4gICAgb3B0aW9ucy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgIHJldHVybiBhLnByaWNlIC0gYi5wcmljZTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG9wdGlvbnM7XHJcbiAgfVxyXG5cclxufVxyXG4iLCIvKlxyXG5Db3B5cmlnaHQgMjAxOCBHb29nbGUgSW5jLlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKi9cclxuXHJcbmltcG9ydCBWaWV3IGZyb20gJ3ZpZXcnO1xyXG5pbXBvcnQgc2VuZFRvU2VydmVyIGZyb20gJ21lcmNoYW50LXNlcnZlcic7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYXltZW50Rm9ybSBleHRlbmRzIFZpZXcge1xyXG5cclxuICBjb25zdHJ1Y3RvcihjYXJ0LCBjb25maXJtYXRpb25WaWV3LCBjb250YWluZXJJZCA9ICdwYXltZW50Jykge1xyXG4gICAgc3VwZXIoY29udGFpbmVySWQpO1xyXG4gICAgdGhpcy5fY2hlY2tvdXRGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnRfZm9ybScpO1xyXG4gICAgdGhpcy5fY2FydCA9IGNhcnQ7XHJcbiAgICB0aGlzLl9jb25maXJtYXRpb25WaWV3ID0gY29uZmlybWF0aW9uVmlldztcclxuICAgIHRoaXMuX3Byb21pc2UgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiBQZXJmb3JtcyB0aGUgY2hlY2tvdXQgdXNpbmcgdGhlIGZvcm0uIFJldHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlblxyXG4gICAqIHRoZSB1c2VyIGNoZWNrcyBvdXQuXHJcbiAgICovXHJcbiAgY2hlY2tvdXQoKSB7XHJcbiAgICAvLyBUT0RPIGhvdyBkbyB3ZSBoYW5kbGUgY2FydCBhYmFuZG9ubWVudD9cclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcclxuICAgIHRoaXMuX3Byb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMuX2NoZWNrb3V0Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiB0ZW1wKGV2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBjb25zdCBkYXRhID0gbmV3IEZvcm1EYXRhKGV2ZW50LnRhcmdldCk7XHJcbiAgICAgICAgc2VsZi5fc2hvd1JlcXVlc3QoZGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShkYXRhKVxyXG4gICAgICAgICAgLnRoZW4oc2VuZFRvU2VydmVyKVxyXG4gICAgICAgICAgLnRoZW4oanNvbiA9PiB7XHJcbiAgICAgICAgICAgIHNlbGYuX3Nob3dSZXNwb25zZShqc29uKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShqc29uKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY2F0Y2goZSA9PiByZWplY3QoZSkpXHJcbiAgICAgICAgICAudGhlbigoKSA9PiBzZWxmLl9jaGVja291dEZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGVtcCkpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuX3Byb21pc2U7XHJcbiAgfVxyXG5cclxuICBhYm9ydCgpIHtcclxuICAgIHRoaXMuX3Byb21pc2UucmVqZWN0KCdhYm9ydGVkJyk7XHJcbiAgfVxyXG5cclxuICBfc2hvd1JlcXVlc3QoZm9ybURhdGEpIHtcclxuICAgIGlmICh0aGlzLl9jb25maXJtYXRpb25WaWV3KSB7XHJcbiAgICAgIHRoaXMuX2NvbmZpcm1hdGlvblZpZXcucmVxdWVzdERhdGEgPSB0aGlzLl90b0pTT04oZm9ybURhdGEpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3Nob3dSZXNwb25zZShqc29uKSB7XHJcbiAgICBpZiAodGhpcy5fY29uZmlybWF0aW9uVmlldykge1xyXG4gICAgICB0aGlzLl9jb25maXJtYXRpb25WaWV3LnJlc3BvbnNlRGF0YSA9IGpzb247XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfdG9KU09OKGZvcm1EYXRhKSB7XHJcbiAgICBsZXQgb2JqID0ge307XHJcbiAgICBmb3IgKGxldCBlbnRyeSBvZiBmb3JtRGF0YSkge1xyXG4gICAgICBvYmpbZW50cnkua2V5XSA9IGVudHJ5LnZhbHVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaik7XHJcbiAgfVxyXG5cclxufVxyXG4iLCIvKlxyXG5Db3B5cmlnaHQgMjAxOCBHb29nbGUgSW5jLlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKi9cclxuXHJcbi8vanNoaW50IGVzdmVyc2lvbjogNlxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvZHVjdCB7XHJcblxyXG4gIGNvbnN0cnVjdG9yIChza3UsIHRpdGxlLCBwcmljZSwgaW1hZ2UsIGRlc2NyaXB0aW9uPScnKSB7XHJcbiAgICB0aGlzLl9za3UgPSBza3U7XHJcbiAgICB0aGlzLl90aXRsZSA9IHRpdGxlO1xyXG4gICAgdGhpcy5fcHJpY2UgPSBwcmljZTtcclxuICAgIHRoaXMuX2ltYWdlID0gaW1hZ2U7XHJcbiAgICB0aGlzLl9kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHNrdSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9za3U7XHJcbiAgfVxyXG5cclxuICBnZXQgdGl0bGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fdGl0bGU7XHJcbiAgfVxyXG5cclxuICBnZXQgcHJpY2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcHJpY2U7XHJcbiAgfVxyXG5cclxuICBnZXQgaW1hZ2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faW1hZ2U7XHJcbiAgfVxyXG5cclxuICBnZXQgZGVzY3JpcHRpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZGVzY3JpcHRpb247XHJcbiAgfVxyXG5cclxufVxyXG4iLCIvKlxyXG5Db3B5cmlnaHQgMjAxOCBHb29nbGUgSW5jLlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKi9cclxuaW1wb3J0IFByb2R1Y3QgZnJvbSAncHJvZHVjdCc7XHJcblxyXG4vLyAgIGNvbnN0cnVjdG9yIChza3UsIHRpdGxlLCBwcmljZSwgaW1hZ2UsIGRlc2NyaXB0aW9uPScnKSB7XHJcblxyXG4vLyBOb3JtYWxseSB5b3Ugd291bGQgZ2V0IHRoZXNlIGZyb20gYSBzZXJ2ZXJcclxuZXhwb3J0IGNvbnN0IHByb2R1Y3RzID0gW1xyXG4gIG5ldyBQcm9kdWN0KCdCYXJyZWxDaGFpcicsICdCYXJyZWwgQ2hhaXInLCAxMDAuMDAsICdCYXJyZWxDaGFpci5qcGcnLFxyXG4gICAgJ0EgYmVhdXRpZnVsIGNoYWlyIG1hZGUgb2YgdXBjeWNsZWQgYmFycmVsIHN0YXZlcycpLFxyXG4gIG5ldyBQcm9kdWN0KCdDMTAnLCAnQzEwIENoYWlyJywgMTAwLjAwLCAnQzEwLmpwZycsXHJcbiAgICAnQSBjb2xvcmZ1bCBjaGFpciB3aXRoIG1vZGVybiBzdHlsZSBhbmQgZmxhaXInKSxcclxuICBuZXcgUHJvZHVjdCgnQ2wyJywgJ0NMMiBDaGFpcicsIDEwMC4wMCwgJ0NsMi5qcGcnLFxyXG4gICAgJ0EgY29tZm9ydGFibGUgZXh0ZW5kZWQgY2hhaXIgbWFkZSBmb3IgbG91bmdpbmcnKSxcclxuICBuZXcgUHJvZHVjdCgnQ1AwM19ibHVlJywgJ0NQMDMgQ2hhaXInLCAxMDAuMDAsICdDUDAzX2JsdWUuanBnJyxcclxuICAgICdBIHdpZGUgY3VzaGlvbiB5b3UgY2FuIHN0YWNrIG9yIG1vdmUgYXJvdW5kIHRoZSBmbG9vcicpLFxyXG4gIG5ldyBQcm9kdWN0KCdDUENfUkVDWUNMRUQnLCAnQ1BDIFVwY3ljbGVkJywgMTAwLjAwLCAnQ1BDX1JFQ1lDTEVELmpwZycsXHJcbiAgICAnQSBzaW1wbGUgY2hhaXIgd2l0aCBhIHNlYXQgb2YgcmVjeWNsZWQgcGxhc3RpYycpLFxyXG4gIG5ldyBQcm9kdWN0KCdDUEZTJywgJ0NQRlMnLCAxMDAuMDAsICdDUEZTLmpwZycsXHJcbiAgICAnQSBmb290c3Rvb2wgbWFkZXIgdG8gY29tcGxlbWVudCB0aGUgQ1BGUyBjaGFpcicpLFxyXG4gIG5ldyBQcm9kdWN0KCdDUE8yX3JlZCcsICdDUE8yJywgMTAwLjAwLCAnQ1BPMl9yZWQuanBnJyxcclxuICAgICdBIG5hcnJvdyBjdXNoaW9uLCBzbWFsbGVyIHRoYW4gQ1AwMywgYW5kIHF1aXRlIGNvbWZvcnRhYmxlJyksXHJcbiAgbmV3IFByb2R1Y3QoJ0NQVCcsICdDUFQgVGFibGUnLCAxMDAuMDAsICdDUFQuanBnJyxcclxuICAgICdBIHBlcmZlY3QgdGFibGUgZm9yIG91dGRvb3JzLCBoYXMgYSBob2xlIGZvciBhbiB1bWJyZWxsYScpLFxyXG4gIG5ldyBQcm9kdWN0KCdDUzEnLCAnQ1MxIFNvZmEnLCAxMDAuMDAsICdDUzEuanBnJyxcclxuICAgICdBIHNvZnQsIHN0eWxpc2gsIGFuZCBjb2xvcmZ1bCBzb2ZhLiBQZXJmZWN0IGZvciB5b3VyIGhvbWUnKVxyXG5dO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRQcm9kdWN0KHNrdSwgc2VhcmNoUmFuZ2UgPSBwcm9kdWN0cykge1xyXG4gIHJldHVybiBzZWFyY2hSYW5nZS5maW5kKHByb2R1Y3QgPT4gcHJvZHVjdC5za3UgPT09IHNrdSk7XHJcbn1cclxuIiwiLypcclxuQ29weXJpZ2h0IDIwMTggR29vZ2xlIEluYy5cclxuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcblxyXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiovXHJcblxyXG5pbXBvcnQgVmlldyBmcm9tICd2aWV3JztcclxuaW1wb3J0IHtwcm9kdWN0cywgZmluZFByb2R1Y3R9IGZyb20gJ3Byb2R1Y3RzJztcclxuaW1wb3J0IHNob3dUb2FzdCBmcm9tICdzbmFja2Jhcic7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTaG9wVmlldyBleHRlbmRzIFZpZXcge1xyXG5cclxuICBjb25zdHJ1Y3RvcihjYXJ0LCBwcm9kdWN0U2VsZWN0aW9uID0gcHJvZHVjdHMsIGNvbnRhaW5lcklkID0gJ3Nob3AnKSB7XHJcbiAgICBzdXBlcihjb250YWluZXJJZCwgdHJ1ZSk7XHJcbiAgICB0aGlzLl9jYXJ0ID0gY2FydDtcclxuICAgIHRoaXMuX3Byb2R1Y3RzID0gcHJvZHVjdFNlbGVjdGlvbjtcclxuICAgIHRoaXMuX2VsZW1lbnQgPSAnZGl2JztcclxuICAgIHRoaXMuX2VsZW1lbnRDbGFzcyA9ICdwcm9kdWN0JztcclxuICAgIHRoaXMuX2FkZEhhbmRsZXIgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgaW5zdGFsbCgpIHtcclxuICAgIC8vIENhcHR1cmUgYWRkIGV2ZW50cyAoY2xpY2tzKSBhcyB0aGV5IGJ1YmJsZSB1cC4gT25seSBhZGQgb25jZS5cclxuICAgIHRoaXMuX2FkZEhhbmRsZXIgPSB0aGlzLl9oYW5kbGVQcm9kdWN0Q2xpY2suYmluZCh0aGlzKTtcclxuICAgIHRoaXMuX2NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2FkZEhhbmRsZXIsIGZhbHNlKTtcclxuICB9XHJcblxyXG4gIHJlbmRlciAoKSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIuaW5uZXJIVE1MID0gJyc7IC8vIHJlbW92ZSBhbGwgY2hpbGRyZW5cclxuICAgIGZvciAobGV0IHByb2R1Y3Qgb2YgdGhpcy5fcHJvZHVjdHMpIHtcclxuICAgICAgbGV0IHBsYWNlaG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgIHBsYWNlaG9sZGVyLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPVwibWRsLWNlbGwgbWRsLWNhcmQgbWRsLXNoYWRvdy0tNGRwIHBvcnRmb2xpby1jYXJkIHByb2R1Y3RcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwibWRsLWNhcmRfX21lZGlhXCI+XHJcbiAgICAgICAgICA8aW1nIGNsYXNzPVwiYXJ0aWNsZS1pbWFnZVwiIHNyYz1cIiBpbWFnZXMvcHJvZHVjdHMvJHtwcm9kdWN0LmltYWdlfVwiIGJvcmRlcj1cIjBcIiBhbHQ9XCJcIj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwibWRsLWNhcmRfX3RpdGxlXCI+XHJcbiAgICAgICAgICA8aDIgY2xhc3M9XCJtZGwtY2FyZF9fdGl0bGUtdGV4dFwiPiR7cHJvZHVjdC50aXRsZX08L2gyPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJtZGwtY2FyZF9fc3VwcG9ydGluZy10ZXh0XCI+XHJcbiAgICAgICAgICAke3Byb2R1Y3QuZGVzY3JpcHRpb259XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cIm1kbC1jYXJkX19hY3Rpb25zIG1kbC1jYXJkLS1ib3JkZXJcIj5cclxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJtZGwtYnV0dG9uIG1kbC1idXR0b24tLWNvbG9yZWQgbWRsLWpzLWJ1dHRvblxyXG4gICAgICAgICAgICBtZGwtanMtcmlwcGxlLWVmZmVjdCBtZGwtYnV0dG9uLS1hY2NlbnQgYWRkLXRvLWNhcnRcIlxyXG4gICAgICAgICAgICBkYXRhLXNrdT1cIiR7cHJvZHVjdC5za3V9XCI+XHJcbiAgICAgICAgICAgIDxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5hZGRfc2hvcHBpbmdfY2FydDwvaT5BZGQgdG8gQ2FydFxyXG4gICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvZGl2PmA7XHJcbiAgICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZChwbGFjZWhvbGRlci5maXJzdEVsZW1lbnRDaGlsZCk7IC8vIFdBUk46IG5vIGllOFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2hhbmRsZVByb2R1Y3RDbGljayhldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIC8vIE1ETCBpbnNlcnRzIGFuIGFuaW1hdGVkIHNwYW4gYXMgYSBjaGlsZCBvZiB0aGUgYnV0dG9uOyBpdCBnZXRzIHRoZSBjbGljay5cclxuICAgIC8vIFdlIG1heSBuZWVkIHRvIGxvb2sgYXQgdGhlIHBhcmVudCB0byBmaW5kIHRoZSBidXR0b24uXHJcbiAgICBsZXQgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xyXG4gICAgaWYgKCF0YXJnZXQgfHwgdGFyZ2V0ID09IHRoaXMuX2NvbnRhaW5lcikgcmV0dXJuO1xyXG4gICAgd2hpbGUgKHRhcmdldC5ub2RlTmFtZSAhPSAnQlVUVE9OJykge1xyXG4gICAgICBpZiAoIXRhcmdldC5wYXJlbnROb2RlKSBicmVhaztcclxuICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRhcmdldC5kYXRhc2V0KSByZXR1cm47XHJcbiAgICBjb25zdCBza3UgPSB0YXJnZXQuZGF0YXNldC5za3U7XHJcbiAgICBpZiAoIXNrdSkgdGhyb3cgbmV3IEVycm9yKCdjb3VsZCBub3QgZmluZCBza3UsIGRhdGEtIGF0dHJzIG5vdCBzdXBwb3J0ZWQ/Jyk7XHJcbiAgICBjb25zdCBwcm9kdWN0ID0gZmluZFByb2R1Y3Qoc2t1LCB0aGlzLl9wcm9kdWN0cyk7XHJcbiAgICB0aGlzLl9jYXJ0LmFkZChwcm9kdWN0KTtcclxuICAgIHRoaXMuX3Nob3dDb25maXJtYXRpb24ocHJvZHVjdCk7XHJcbiAgfVxyXG5cclxuICBfc2hvd0NvbmZpcm1hdGlvbihwcm9kdWN0KSB7XHJcbiAgICBzaG93VG9hc3QoYCR7cHJvZHVjdC5za3V9IGFkZGVkIHRvIGNhcnRgKTtcclxuICB9XHJcblxyXG4gIC8vIHV0aWxpdHkgZm9yIHVuaXQgdGVzdGluZyAodXNlZCBpbiBjb3VudGluZyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzKVxyXG4gIGdldCBpdGVtU2VsZWN0b3IoKSB7XHJcbiAgICByZXR1cm4gYCR7dGhpcy5fZWxlbWVudH0uJHt0aGlzLl9lbGVtZW50Q2xhc3N9YDtcclxuICB9XHJcblxyXG59XHJcbiIsIi8qXHJcbkNvcHlyaWdodCAyMDE4IEdvb2dsZSBJbmMuXHJcblxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG5cclxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qL1xyXG5cclxuLy9qc2hpbnQgZXN2ZXJzaW9uOiA2XHJcblxyXG4vLyBQb3AgdXAgYSB1c2VyIG5vdGlmaWNhdGlvblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzaG93VG9hc3QobWVzc2FnZSkge1xyXG4gIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzbmFja2JhcicpO1xyXG4gIGlmIChub3RpZmljYXRpb24gJiYgKCdNYXRlcmlhbFNuYWNrYmFyJyBpbiBub3RpZmljYXRpb24pKSB7XHJcbiAgICBub3RpZmljYXRpb24uTWF0ZXJpYWxTbmFja2Jhci5zaG93U25hY2tiYXIoe21lc3NhZ2U6IChtZXNzYWdlKX0pO1xyXG4gIH1cclxufVxyXG4iLCIvKlxyXG5Db3B5cmlnaHQgMjAxOCBHb29nbGUgSW5jLlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKi9cclxuXHJcbi8vanNoaW50IGVzdmVyc2lvbjogNlxyXG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZUxvY2F0aW9uSGFzaChoYXNoLCBiYXNlVXJsID0gd2luZG93LmxvY2F0aW9uKSB7XHJcbiAgbGV0IHVybCA9IHVybFdpdGhIYXNoKGhhc2gsIGJhc2VVcmwpO1xyXG4gIGhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCBcIlwiLCB1cmwpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcHVzaExvY2F0aW9uSGFzaChoYXNoLCBiYXNlVXJsID0gd2luZG93LmxvY2F0aW9uKSB7XHJcbiAgd2luZG93LmxvY2F0aW9uID0gdXJsV2l0aEhhc2goaGFzaCwgYmFzZVVybCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVybFdpdGhIYXNoKGhhc2gsIGJhc2VVcmwpIHtcclxuICBsZXQgdXJsID0gYmFzZVVybC50b1N0cmluZygpO1xyXG4gIGxldCBpbmRleCA9IHVybC5pbmRleE9mKCcjJyk7XHJcbiAgaWYgKGluZGV4ID49IDApIHVybCA9IHVybC5zdWJzdHJpbmcoMCwgaW5kZXgpO1xyXG4gIHJldHVybiB1cmwgKyAgJyMnICsgaGFzaDtcclxufTtcclxuIiwiLypcclxuQ29weXJpZ2h0IDIwMTggR29vZ2xlIEluYy5cclxuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcblxyXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiovXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWaWV3IHtcclxuICBjb25zdHJ1Y3Rvcihjb250YWluZXJJZCwgcmVuZGVyQmVmb3JlVmlzaWJsZSA9IGZhbHNlKSB7XHJcbiAgICB0aGlzLl9jb250YWluZXJJZCA9IGNvbnRhaW5lcklkO1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5fY29udGFpbmVySWQpO1xyXG4gICAgdGhpcy5fbmVlZHNSZW5kZXIgPSByZW5kZXJCZWZvcmVWaXNpYmxlO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgLy8gb3ZlcnJpZGUgdGhpc1xyXG4gIH1cclxuXHJcbiAgc2V0IHZpc2libGUodmlzKSB7XHJcbiAgICBpZiAodmlzICYmICF0aGlzLnZpc2libGUgJiYgdGhpcy5fbmVlZHNSZW5kZXIpIHtcclxuICAgICAgLy8gYmVjb21pbmcgdmlzaWJsZSwgdXBkYXRlXHJcbiAgICAgIHRoaXMucmVuZGVyKCk7XHJcbiAgICB9XHJcbiAgICBpZiAodmlzKSB7XHJcbiAgICAgIHRoaXMuX2NvbnRhaW5lci5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXQgdmlzaWJsZSgpIHtcclxuICAgIHJldHVybiAhdGhpcy5fY29udGFpbmVyLmhhc0F0dHJpYnV0ZSgnaGlkZGVuJyk7XHJcbiAgfVxyXG5cclxufVxyXG4iLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuICBcbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIGluc3RhbmNlLml0ZXJhdGVDdXJzb3IocXVlcnksIGZ1bmN0aW9uKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiJdfQ==
